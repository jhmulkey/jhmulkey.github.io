var _archiveMove = false; // if true, permanently sets _ew to max value
var _rankPts = [0,10,20,30,40,50,60,70,80,100,110,120,130,140,150,170,180,190,200,220];
var _asMaxPts = [3,3,3,3,3,3,3,3,3,3,3,6,3,3,3,3,3,3,3,3,3,3,3,3,6,3,3,3,3,3,3,3];
var _mvMaxPts = [4,6,3,3,3,5,5,5,4,4,3,3,4,3,3,3,4,3,4,3,4,3,3,3,6,4,4,3,4,3,3,3];
var _leapYear = false; // true if Jan-July falls within a leap year
var _dns = [21,28,42,49,56,63,70,77,84,91,98,105,126,133,140,161,168,175,182,189,196,203,210,217,224,231,238,245,259,266,273,280,287,294]; // (generated by _assignClassDns function in console)
var _asNum;var _mvNum;var _asPts;var _todaysDn;var _ew;var _isClassDay;var _weeksOff=0;var _noteIndex;var _reminders=[];var _reminderIndex;var _log="";var _gameLog="";var _currentPop;var _currentPops;var _currentPops2;var _array;var _focus;var _currentFunction;var _currentParameter;var _eligibleRandom;var _picked;var _teams=[];var _dataInputParameter;var _att=[];var _pwd=[];var _skipPhotos=[];var _currentProperty;var _disableAtt=false;var _doublesIndexes = [];
var _rankNamesShort = ["PVT","PFC","CPL","SGT","SSG","SFC","MSG","SGM","CSM","2LT","1LT","CPT","MAJ","LTC","COL","BG","MG","LTG","GEN","GOA"];
var _rankNames = ["Private","Private First Class","Corporal","Sergeant","Staff Sergeant","Sergeant First Class","Master Sergeant","Sergeant Major","Command Sergeant Major","Second Lieutenant","First Lieutenant","Captain","Major","Lieutenant Colonel","Colonel","Brigadier General","Major General","Lieutenant General","General","General of the Army"];
var _asNames = ["class-intro","jn-intro","jn-1","jn-2","jn-3","jn-4","jn-5","jn-6","jn-7","jn-8","jn-9","jn-1-9-review","jn-10","jn-11","jn-12","jn-13","jn-14","jn-15","jn-16","jn-17","jn-18","jn-19","jn-20","jn-21","jn-10-21-review","armor-intro","belt","breastplate","shoes","shield","helmet","sword"];
var _asFulls = ["Class Intro","John Intro","John 1","John 2","John 3","John 4","John 5","John 6","John 7","John 8","John 9","John 1-9 Review","John 10","John 11","John 12","John 13","John 14","John 15","John 16","John 17","John 18","John 19","John 20","John 21","John 10-21 Review","Armor Intro","Belt","Breastplate","Shoes","Shield","Helmet","Sword"];
var _mvNames = ["ps-139-17-18","jn-20-30-31","jn-1-1-2","jn-1-3","jn-1-4-5","jn-1-6-8","jn-1-9-11","jn-1-12-13","jn-1-14","jn-1-15","jn-1-16-17","jn-1-18","phil-2-5-6","phil-2-7","phil-2-8","phil-2-9","phil-2-10-11","rom-8-31","rom-8-32","rom-8-33","rom-8-34","rom-8-35","rom-8-36","rom-8-37","rom-8-38-39","eph-6-10-11","eph-6-12","eph-6-13","eph-6-14-15","eph-6-16","eph-6-17","eph-6-18"];
var _mvFulls = ["Psalm 139:17-18","John 20:30-31","John 1:1-2","John 1:3","John 1:4-5","John 1:6-8","John 1:9-11","John 1:12-13","John 1:14","John 1:15","John 1:16-17","John 1:18","Phil 2:5-6","Phil 2:7","Phil 2:8","Phil 2:9","Phil 2:10-11","Rom 8:31","Rom 8:32","Rom 8:33","Rom 8:34","Rom 8:35","Rom 8:36","Rom 8:37","Rom 8:38-39","Eph 6:10-11","Eph 6:12","Eph 6:13","Eph 6:14-15","Eph 6:16","Eph 6:17","Eph 6:18"];
var _mvText = [
    "How precious to me are your thoughts, O God! How vast is the sum of them! If I would count them, they are more than the sand. I awake, and I am still with you.",
    "Now Jesus did many other signs in the presence of the disciples, which are not written in this book; but these are written so that you may believe that Jesus is the Christ, the Son of God, and that by believing you may have life in his name.",
    "In the beginning was the Word, and the Word was with God, and the Word was God. He was in the beginning with God.",
    "All things were made through him, and without him was not any thing made that was made.",
    "In him was life, and the life was the light of men. The light shines in the darkness, and the darkness has not overcome it.",
    "There was a man sent from God, whose name was John. He came as a witness, to bear witness about the light, that all might believe through him. He was not the light, but came to bear witness about the light.",
    "The true light, which gives light to everyone, was coming into the world. He was in the world, and the world was made through him, yet the world did not know him. He came to his own, and his own people did not receive him.",
    "But to all who did receive him, who believed in his name, he gave the right to become children of God, who were born, not of blood nor of the will of the flesh nor of the will of man, but of God.",
    "And the Word became flesh and dwelt among us, and we have seen his glory, glory as of the only Son from the Father, full of grace and truth.",
    "(John bore witness about him, and cried out, “This was he of whom I said, 'He who comes after me ranks before me, because he was before me.’”)",
    "For from his fullness we have all received, grace upon grace. For the law was given through Moses; grace and truth came through Jesus Christ.",
    "No one has ever seen God; the only God, who is at the Father's side, he has made him known.",
    "Have this mind among yourselves, which is yours in Christ Jesus, who, though he was in the form of God, did not count equality with God a thing to be grasped,",
    "but emptied himself, by taking the form of a servant, being born in the likeness of men.",
    "And being found in human form, he humbled himself by becoming obedient to the point of death, even death on a cross.",
    "Therefore God has highly exalted him and bestowed on him the name that is above every name,",
    "so that at the name of Jesus every knee should bow, in heaven and on earth and under the earth, and every tongue confess that Jesus Christ is Lord, to the glory of God the Father.",
    "What then shall we say to these things? If God is for us, who can be against us?",
    "He who did not spare his own Son but gave him up for us all, how will he not also with him graciously give us all things?",
    "Who shall bring any charge against God's elect? It is God who justifies.",
    "Who is to condemn?  Christ Jesus is the one who died—more than that, who was raised—who is at the right hand of God, who indeed is interceding for us.",
    "Who shall separate us from the love of Christ? Shall tribulation, or distress, or persecution, or famine, or nakedness, or danger, or sword?",
    "As it is written, 'For your sake we are being killed all the day long; we are regarded as sheep to be slaughtered.'",
    "No, in all these things we are more than conquerors through him who loved us.",
    "For I am sure that neither death nor life, nor angels nor rulers, nor things present nor things to come, nor powers, nor height nor depth, nor anything else in all creation, will be able to separate us from the love of God in Christ Jesus our Lord.",
    "Finally, be strong in the Lord and in the strength of his might. Put on the whole armor of God, that you may be able to stand against the schemes of the devil.",
    "For we do not wrestle against flesh and blood, but against the rulers, against the authorities, against the cosmic powers over this present darkness, against the spiritual forces of evil in the heavenly places.",
    "Therefore take up the whole armor of God, that you may be able to withstand in the evil day, and having done all, to stand firm.",
    "Stand therefore, having fastened on the belt of truth, and having put on the breastplate of righteousness, and, as shoes for your feet, having put on the readiness given by the gospel of peace.",
    "In all circumstances take up the shield of faith, with which you can extinguish all the flaming darts of the evil one;",
    "and take the helmet of salvation, and the sword of the Spirit, which is the word of God,",
    "praying at all times in the Spirit, with all prayer and supplication. To that end, keep alert with all perseverance, making supplication for all the saints," 
];

/* INDEX + RANK / POINTS / RANK FACTOR
0 PVT / 0
1 PFC / 10
2 CPL / 20
3 SGT / 30
4 SSG / 40
5 SFC / 50
6 MSG / 60
7 SGM / 70
8 CSM / 80
9 2LT / 100 / 1
10 1LT / 110
11 CPT / 120
12 MAJ / 130
13 LTC / 140
14 COL / 150 
15 BG / 170 / 2
16 MG / 180
17 LTG / 190
18 GEN / 200 
19 GOA / 220 / 3
*/

class Student {
    constructor() {
        this.dateAdded = _todaysDn;
        this.photo = false;
        this.pts = 0;
        this.gamePts = [0,0]; // [gamePts,gameRank]
        this.rank = [0,0]; // [rankNumber,rankFactor]
        this.att = true;
        this.attArr = [];
        this.promo = 0; // number of current promotions earned
        this.promoDns = []; // promotion dates
        this.randDraw = [false,false];
        this.statsRanks = []; // [tot,AS,MV,att,part]
        this.as = [] // [ptsEarned,dateCompleted]
        this.mv = [] // [ptsEarned,dateRecited]
    }
}

/* other Student properties 
    this.bd = [0,false,false,0] // [bdn,bdFound,bdComplete,bdCompleteDn]
*/

class Teams {
    constructor () {
        this.team1 = [];
        this.team2 = [];
        this.team1Reset = [];
        this.team2Reset = [];
        this.team1Score = 0;
        this.team2Score = 0;
        this.currentTeam = 1;
        this.currentPlayer;
        this.undoGamePts;
        this.undoLimit = true;
        this.undoTeam;
    }
}

function assignPin(_ci,bypass) {
    if (!bypass) {
        var pins = []
        for (let i = 0; i < _sl.length; i++) {
            if (i == _ci) {continue}
            pins.push(_sl[i].pin);
        }
    }
    var pin = Math.floor(Math.random()*1000);
    if (pin < 99) {pin+= ((100-pin) + Math.floor(Math.random()*100))}
    for (let i = 0; i < pins.length; i++) {
        if (pins.indexOf(pin) < 0) {_sl[_ci].pin = pin;return} else {assignPin(_ci,true)}
    }
}

function batchAssignPin() {
    var pins = [];
    for (let i = 0; i < _sl.length; i++) {
        var pin = Math.floor(Math.random()*1000);
        if (pin < 99) {pin+= ((100-pin) + Math.floor(Math.random()*100))}
        if (pins.indexOf(pin) < 0) {pins.push(pin)} else {i--}
    }
    for (let i = 0; i < _sl.length; i++) {
        _sl[i].pin = pins[i];
    }
}

function color(id,color) {
    document.getElementById(id).style.color = color;
}

function bgColor(id,color) {
    document.getElementById(id).style.backgroundColor = color;
}

function colorbgColor(id,color,bgColor) {
    document.getElementById(id).style.color = color;
    document.getElementById(id).style.backgroundColor = bgColor;
}

function border(id,width,type,color) {
    document.getElementById(id).style.border = width+"px "+type+" "+color;
}

function innerHTML(id,innerHTML) {
    document.getElementById(id).innerHTML = innerHTML;
}

function display(id,display) {
    document.getElementById(id).style.display = display;
}

function idFontSize(id,fontSize) {
    document.getElementById(id).style.fontSize = fontSize+"px";
}

function value(id,value) {
    document.getElementById(id).value = value;
}

function idFocus(id) {
    document.getElementById(id).focus();
}

function append(id,element) {
    document.getElementById(id).append(element);
}

function createElement(elementName) {
    return document.createElement(elementName);
}

function whatToLoad() {
    if (!localStorage.getItem("sl") && !localStorage.getItem("slBackup")) {
        infoAlert("No data",["mainPop"]);
    } else if (!localStorage.getItem("sl") && localStorage.getItem("slBackup")) {
        loadBackup();
    } else if (localStorage.getItem("sl") && localStorage.getItem("slBackup")) {
        pop(['mainPop'],['wtlPop'])
    }
}

function loadBackup() {
    _sl = JSON.parse(localStorage.getItem("slBackup"));
    _slOLD = JSON.parse(localStorage.getItem("slBackupOLD"));
    _att = JSON.parse(localStorage.getItem("attBackup"));
    _reminders = JSON.parse(localStorage.getItem("remindersBackup"));
    activityLog("backup loaded",dateAndTime("log"));
    for (let i = 0; i < _sl.length; i++) {
        _sl[i].randDraw[0] = false;
    }
    clearAttendees(); clearPromos(); populateReminders(); findAllBds(); storeAndBackup(); goHome();
}

function clearPromos() {
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].promo > 0 && _sl[i].promoDns[_sl[i].rank[0]] > 0) {
            _sl[i].promo = 0;
        }
    }
}

function loadLS() {
    _sl = JSON.parse(localStorage.getItem("sl"));
    _att = JSON.parse(localStorage.getItem("att"));
    _log = localStorage.getItem("log");
    _gameLog = localStorage.getItem("gameLog");
    innerHTML("log",_log); innerHTML("gameLog",_gameLog);
    _reminders = JSON.parse(localStorage.getItem("reminders"));
    _teams = JSON.parse(localStorage.getItem("teams"));
    populateReminders(); attCount(); findAllBds();
    activityLog("localstorage loaded",dateAndTime("log"));
    backupNewData(); goHome();
}

function pwdEntry() {
    var pwd = parseInt(document.getElementById("pwd").value);
    if (pwd == 3784) {
        loadBackup();
        display("pwdPop","none");
        value("pwd","");
    } else {
        infoAlert("incorrect password",["pwdPop"],"pwd");
        value("pwd",""); pwd = 0;
    }
}

function pwdAutoEnter() {
    if (document.getElementById("pwd").value.length == 4) {pwdEntry()}
}

function assignTodaysDn() {
    var todaysMonth = dateAndTime("month"); 
    var todaysDate = dateAndTime("date")
    var cumulative = [153,184,212,243,273,304,334,0,31,61,92,122];
    var cumulativeLeap = [153,184,213,244,274,305,335,0,31,61,92,122];
    var dn;
    if (todaysMonth < 3 || todaysMonth > 7) {
        dn = (cumulative[todaysMonth-1]) + todaysDate;
    }
    if (todaysMonth > 2 || todaysMonth < 8) {
        if (_leapYear) {
            dn = (cumulativeLeap[todaysMonth-1]) + todaysDate;
        } else {
            dn = (cumulative[todaysMonth-1]) + todaysDate;
        }
    }
    _todaysDn = dn;
    setWeeksOff(); isClassDay(); setEw(); populateMissions(); generateAllTables();
}

function isClassDay() {
    if (_dns.indexOf(_todaysDn) > -1) {
        _isClassDay = true; 
    }
}

function setWeeksOff() {
    if (_isClassDay) {
        if (_dns[_dns.indexOf(_todaysDn)+1] - _todaysDn == 14) {
            _weeksOff = 1;
        } else if (_dns[_dns.indexOf(_todaysDn)+1] - _todaysDn == 21) {
            _weeksOff = 2;
        } else {
            _weeksOff = 0;
        }
    }
}

function setEw() {
    if (_archiveMove) {_ew = _dns.length;return}
    for (let i = 0; i < _dns.length; i++) {
        if (_todaysDn == _dns[i]) {
            _ew = i + 1; break;
        }
        if (_todaysDn > _dns[0] && _todaysDn < _dns[i]) {
            _ew = i; break;
        }
        if (_todaysDn < _dns[0] || _todaysDn > _dns[_dns.length-1]) {
            _ew = _dns.length;
        }
    }
    _ti = _ew - 1;
}

function dateAndTime(x) {
    var today = new Date();
    if (x == "month") {return today.getMonth() + 1}
    if (x == "date") {return today.getDate()}
    if (x == "hour") {return today.getHours()}
    if (x == "full") {return (today.getMonth() + 1) + "/" + today.getDate()}
    if (x == "log") {return (today.getMonth() + 1)+"/"+today.getDate()+"/"+today.getFullYear()+" "+today.getHours()+":"+today.getMinutes()+":"+today.getSeconds()}
}

function allAlerts() {
    var alerts = [0,0,0,0,0,0];
    var ids = ["remindersButton","promoButton","bdButton","photosNeededButton","emailsNeededButton","bdNeededButton"]
    if (_reminders != false) {alerts[0]++}
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].att) {
            if (_sl[i].promo > 0 && _sl[i].promoDns[_sl[i].rank[0]] == 0) {alerts[1]++}
            if (_sl[i].bd[1] && !_sl[i].bd[2]) {alerts[2]++}
            if (!_sl[i].photo) {alerts[3]++}
            if (_sl[i].email == false) {alerts[4]++}
            if (_sl[i].bd[0] == 0) {alerts[5]++}
        }
    }
    for (let i = 0; i < alerts.length; i++) {
        if (alerts[i] > 0) {bgColor(ids[i],"red")} else {bgColor(ids[i],"rgba(187,187,187,0.25)")}
    }
    if (sumArray(alerts) > 0) {
        bgColor("alertButton","red")
    } else {
        bgColor("alertButton","#111")
    }
    if (allergiesPresent()) {
        border("attCountButton",2,"solid","red")
    } else {
        border("attCountButton",2,"solid","#333")
    }
}

function allergiesPresent() {
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].allergies && _sl[i].att) {return true}
    }
    return false;
}

function generateAllTables() {
    generateRankTable(); generateAttListTable(); generateStudentAttTable(); generateStudentStatsTables(); generateCalendarTable();
}

function populateCustomList(log1,log2,type) {
    if (log1) {
        var p1 = createElement("p");
        p1.classList.add("name");
        p1.innerHTML = log1;
        if (type == "promo") {
            var message;
            if (_sl[i].name[1] != "") {
                message = 'Complete promotion for <br>' + _sl[i].name[0] + ' (' + _rankNamesShort[_sl[i].rank[0]] + ')?' + '<br>' + '("' + _sl[i].name[1] + '")'
            } else {
                message = "Complete promotion for <br>" + _sl[i].name[0] + " (" + _rankNamesShort[_sl[i].rank[0]] + ")?"
            }
            (function(i){
                p1.onclick = function () {
                    actionAlert(message,["customListPop"],completePromo,false,i);
                }
            })(i);
        } else if (type == "bdDone") {
            (function(i){
                p1.onclick = function () {
                    actionAlert("Complete birthday for <br>" + _sl[i].name[0] + "?",["customListPop"],completeBd,false,i);
                }
            })(i);
        } else if (type == "photo") {
            (function(i){
                p1.onclick = function () {
                    actionAlert("Take photo for <br>" + _sl[i].name[0] + "?",["customListPop"],completePhoto,false,i);
                }
            })(i);
        } else if (type == "email") {
            (function(i){
                p1.onclick = function () {
                    _ci = i;
                    populateStudentFields("editEmail",loadNeededEmails);
                }
            })(i);
        } else if (type == "bdNeeded") {
            (function(i){
                p1.onclick = function () {
                    _ci = i;
                    populateStudentFields("editBdMonth",loadNeededBds);
                    value("editBdMonth","");
                    value("editBdDate",""); 
                }
            })(i);
        }
        append("customList",p1);
    }
    if (log2) {
        var p2 = createElement("p");
        p2.classList.add("name");
        p2.innerHTML = log2;
        append("customListAbsent",p2);
    }
}

function loadPromos() {
    innerHTML("customList",""); innerHTML("customListAbsent","");
    innerHTML("customListLabel","Promotions"); display("absentLabel","none");
    for (i = 0; i < _sl.length; i++) {
        if (_sl[i].promo > 0 && _sl[i].promoDns[_sl[i].rank[0]] == 0 && _sl[i].att) {
            populateCustomList(_rankNamesShort[_sl[i].rank[0]] + " " + _sl[i].name[0] + " (" + _sl[i].promo + ")",false,"promo");
        } else if (_sl[i].promo > 0 && _sl[i].promoDns[_sl[i].rank[0]] == 0 && !_sl[i].att) {
            display("absentLabel","block");
            populateCustomList(false,_rankNamesShort[_sl[i].rank[0]] + " " + _sl[i].name[0] + " (" + _sl[i].promo + ")");
        }
    }
}

function loadBds() {
    innerHTML("customList",""); innerHTML("customListAbsent","");
    innerHTML("customListLabel","Birthdays"); display("absentLabel","none");
    for (i = 0; i < _sl.length; i++) {
        if (_sl[i].bd[1] && !_sl[i].bd[2] && _sl[i].att) {
            populateCustomList(_sl[i].name[0] + " (" + cdn(_sl[i].bd[0]) + ")",false,"bdDone");
        } else if (_sl[i].bd[1] && !_sl[i].bd[2] && !_sl[i].att) {
            display("absentLabel","block");
            populateCustomList(false,_sl[i].name[0]+" (" + cdn(_sl[i].bd[0]) + ")");
        }
    }
}

function loadNeededPhotos() {
    innerHTML("customList",""); innerHTML("customListAbsent","");
    innerHTML("customListLabel","Missing Photos"); display("absentLabel","none");
    for (i = 0; i < _sl.length; i++) {
        if (!_sl[i].photo && _sl[i].att) {
            populateCustomList(_sl[i].name[0],false,"photo");
        } else if (!_sl[i].photo && !_sl[i].att) {
            display("absentLabel","block");
            populateCustomList(false,_sl[i].name[0]);
        }
    }
}

function loadNeededEmails() {
    innerHTML("customList",""); innerHTML("customListAbsent","");
    innerHTML("customListLabel","Missing Emails"); display("absentLabel","none");
    for (i = 0; i < _sl.length; i++) {
        if (_sl[i].email == "" && _sl[i].att) {
            populateCustomList(_sl[i].name[0],false,"email");
        } else if (_sl[i].email == "" && !_sl[i].att) {
            display("absentLabel","block");
            populateCustomList(false,_sl[i].name[0]);
        }
    }
}

function loadNeededBds() {
    innerHTML("customList",""); innerHTML("customListAbsent","");
    innerHTML("customListLabel","Missing Birthdays"); display("absentLabel","none");
    for (i = 0; i < _sl.length; i++) {
        if (_sl[i].bd[0] == 0 && _sl[i].att) {
            populateCustomList(_sl[i].name[0],false,"bdNeeded");
        } else if (_sl[i].bd[0] == 0 && !_sl[i].att) {
            display("absentLabel","block");
            populateCustomList(false,_sl[i].name[0]);
        }
    }
}

function completePromo(x) {
    _sl[x].promoDns[_sl[x].rank[0]] = _todaysDn;
    if (_sl[x].promo > 1) {
        for (let i = 1; i <= (_sl[x].promo-1); i++) {
            _sl[x].promoDns[_sl[x].rank[0]-i] = _todaysDn;
        }
    }
    activityLog(_sl[x].name[0] + " promotion complete",dateAndTime("log"));
    loadPromos(); allAlerts(); storeAndBackup();
}

function completeBd(x) {
    _sl[x].bd[2] = true; _sl[x].bd[3] = _todaysDn; 
    activityLog(_sl[x].name[0] + " birthday complete",dateAndTime("log"));
    loadBds(); allAlerts(); storeAndBackup();
}

function completePhoto(x) {
    _sl[x].photo = true; loadNeededPhotos(); allAlerts(); storeAndBackup();
    activityLog(_sl[x].name[0] + " photo complete",dateAndTime("log"));
}

function teams() {
    var attCount = 0;
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].att) {
            attCount++
        }
    }
    if (_teams != "") {
        populateTeams();
        pop(["mainMenuPop"],["teamsListPop"]);
    } else if (attCount < 2) {
        infoAlert("At least two students must be in attendance to create teams",["mainMenuPop"]);
    } else {
        createTeams();
        populateTeams();
        pop(["mainMenuPop"],["teamsListPop"]);
    }
}

function createTeams() {
    _teams.pop();
    for (let i = 0; i < _sl.length; i++) {
        _sl[i].gamePts[0] = 0;
        _sl[i].gamePts[1] = 0;
    }
    var teamObject = new Teams; _teams.push(teamObject);
    innerHTML("team1Score",0); innerHTML("team2Score",0);
    var attendees = [];
    for (let i = 0; i <_sl.length; i++) {
        if (_sl[i].att) {
            attendees.push(_sl[i].name[0])
        }
    }
    shuffleArray(attendees);
    var remainder = 0
    if (attendees.length % 2 == 1) { remainder = 1 }
    for (let i = 0; i < attendees.length; i++) {
        if (i < ((attendees.length - remainder) / 2)) {
            _teams[0].team1.push(attendees[i]);
            _teams[0].team1Reset.push(attendees[i]);
        } else {
            _teams[0].team2.push(attendees[i]);
            _teams[0].team2Reset.push(attendees[i]);           
        }
    }
    _teams[0].currentPlayer = _teams[0].team1[0];
    for (let i =1; i < 11; i++) {
        bgColor("gamePoint"+i,"black");
    }
    innerHTML("gameLog","");
    populateTeams();
    storeNewData();
}

function populateTeams() {
    innerHTML("team1List",""); innerHTML("team2List","");
    for (let i = 0; i < _teams[0].team1Reset.length; i++) {
        var p = createElement("p");
        p.classList.add("name2");
        p.innerHTML = _teams[0].team1Reset[i];
        append("team1List",p);
    }
    for (let i = 0; i < _teams[0].team2Reset.length; i++) {
        var p = createElement("p");
        p.classList.add("name2");
        p.innerHTML = _teams[0].team2Reset[i];
        append("team2List",p);
    }
}

function loadGame() {
    if (_teams[0].currentTeam == 1) {
        bgColor("team1Score","yellow");
        bgColor("team2Score","#eee");
    } else {
        bgColor("team2Score","yellow");
        bgColor("team1Score","#eee");
    }
    innerHTML("team1Score",_teams[0].team1Score);
    innerHTML("team2Score",_teams[0].team2Score);
    if (_teams[0].undoTeam != _teams[0].currentTeam) {
        innerHTML("currentPlayer","Current Player:<br><span style='color: lawngreen'>" + _teams[0].currentPlayer + "</span>");
    } else {
        innerHTML("currentPlayer","Current Player:<br><span style='color: lawngreen'>" + _teams[0].undoCurrentPlayer + "</span>");
    }
    pop(["teamsListPop"],["playGamePop"]);
}

function gameScorePts(x) {
    _teams[0].undoGamePts = x; _teams[0].undoLimit = false; var log;
    if (_teams[0].currentTeam == 1) {
        gameActivityLog(_teams[0].team1[0] + " +" + x + " pts team 1 (" + _teams[0].team1Score + "-->" + (_teams[0].team1Score + x) + ")",dateAndTime("log"));
        _teams[0].team1Score += x;
        innerHTML("team1Score",_teams[0].team1Score);
        _teams[0].currentTeam ++;
        _teams[0].undoCurrentPlayer = _teams[0].team1[0];
        _teams[0].undoTeam = 1;
        for (let i = 0; i < _sl.length; i++) {
            if (_sl[i].name[0] == _teams[0].undoCurrentPlayer) {
                _sl[i].gamePts[0] += x; break;
            }
        }
        _teams[0].team1.shift();
        _teams[0].currentPlayer = _teams[0].team2[0];
        innerHTML("currentPlayer","Current Player:<br><span style='color: lawngreen'>" + _teams[0].team2[0] + "</span>");
        bgColor("team2Score","yellow");
        bgColor("team1Score","#eee");
        if (_teams[0].team1.length == 0) {
            for (let i = 0; i < _teams[0].team1Reset.length; i++) {
                _teams[0].team1.push(_teams[0].team1Reset[i])
            }
        }
        storeNewData();
    } else {
        gameActivityLog(_teams[0].team2[0] + " +" + x + " pts team 2 (" + _teams[0].team2Score + "-->" + (_teams[0].team2Score + x) + ")",dateAndTime("log"));
        _teams[0].team2Score += x;
        innerHTML("team2Score",_teams[0].team2Score);
        _teams[0].currentTeam --;
        _teams[0].undoCurrentPlayer = _teams[0].team2[0];
        _teams[0].undoTeam = 2;
        for (let i = 0; i < _sl.length; i++) {
            if (_sl[i].name[0] == _teams[0].undoCurrentPlayer) {
                _sl[i].gamePts[0] += x; break;
            }
        }
        _teams[0].team2.shift();
        _teams[0].currentPlayer = _teams[0].team1[0];
        innerHTML("currentPlayer","Current Player:<br><span style='color: lawngreen'>" + _teams[0].team1[0] + "</span>");
        bgColor("team1Score","yellow");
        bgColor("team2Score","#eee");
        if (_teams[0].team2.length == 0) {
            for (let i = 0; i < _teams[0].team2Reset.length; i++) {
                _teams[0].team2.push(_teams[0].team2Reset[i])
            }
        }
        storeNewData();
    }
    for (let i =1; i < 11; i++) {
        if (i == x) {
            bgColor("gamePoint"+i,"midnightblue");
        } else {
            bgColor("gamePoint"+i,"black");
        }
    }
}

function undoGameScorePts() {
    var log;
    if (_teams[0].undoLimit) {
        infoAlert("Cannot undo more than one score in a row",["playGamePop"]);return
    } else {
        _teams[0].undoLimit = true;
    }
    if (_teams[0].currentTeam == 1) {
        gameActivityLog("undo " + _teams[0].undoCurrentPlayer + " -" + _teams[0].undoGamePts + " pts team 2 " + "(" + _teams[0].team2Score + "-->" + (_teams[0].team2Score - _teams[0].undoGamePts) + ")",dateAndTime("log"));
        _teams[0].currentTeam = 2;
        _teams[0].team2Score -= _teams[0].undoGamePts;
        for (let i = 0; i < _sl.length; i++) {
            if (_sl[i].name[0] == _teams[0].undoCurrentPlayer) {
                _sl[i].gamePts[0] -= _teams[0].undoGamePts; break;
            }
        }
        innerHTML("team2Score",_teams[0].team2Score);
        _teams[0].team2.unshift(_teams[0].undoCurrentPlayer);
        innerHTML("currentPlayer","Current Player:<br><span style='color: lawngreen'>" + _teams[0].team2[0] + "</span>");
        bgColor("team2Score","yellow");
        bgColor("team1Score","#eee");
    } else if (_teams[0].currentTeam == 2) {
        gameActivityLog("undo " + _teams[0].undoCurrentPlayer + " -" + _teams[0].undoGamePts + " pts team 1 " + "<br>" + "(" + _teams[0].team1Score + "-->" + (_teams[0].team1Score - _teams[0].undoGamePts) + ")",dateAndTime("log"));
        _teams[0].currentTeam = 1;
        _teams[0].team1Score -= _teams[0].undoGamePts;
        for (let i = 0; i < _sl.length; i++) {
            if (_sl[i].name[0] == _teams[0].undoCurrentPlayer) {
                _sl[i].gamePts[0] -= _teams[0].undoGamePts; break;
            }
        }
        innerHTML("team1Score",_teams[0].team1Score);
        _teams[0].team1.unshift(_teams[0].undoCurrentPlayer);
        innerHTML("currentPlayer","Current Player:<br><span style='color: lawngreen'>" + _teams[0].team1[0] + "</span>");
        bgColor("team1Score","yellow");
        bgColor("team2Score","#eee");
    }
    storeNewData();
}

function adjustGameScore(parameter,data) {
    var original
    if (parameter == 1) { 
        original = _teams[0].team1Score;
        _teams[0].team1Score = data;
    } else { 
        original = _teams[0].team2Score
        _teams[0].team2Score = data;
    }
    innerHTML("team"+parameter+"Score",data);
    gameActivityLog("Team " + parameter.toString() + " pts set " + "<br>" + original + "-->" + data,dateAndTime("log"));
    storeAndBackup();
}

function gameActivityLog(textA,textB) {
    var p = createElement("p");
    var span1 = createElement("span");
    var span2 = createElement("span"); span2.style.color = "#bbb";
    var br1 = createElement("br");
    span1.innerHTML = textA; span2.innerHTML = textB;
    p.classList.add("gameLogEntry");
    span1.classList.add("gameLogSpan");
    p.append(span1,br1,span2)
    append("gameLog",p);
    _gameLog = document.getElementById("gameLog").innerHTML;
    storeNewData();
}

function skipPlayer() {
    var log;
    if (_teams[0].currentTeam == 1) {
        gameActivityLog("skipped " + _teams[0].team1[0],dateAndTime("log"));
        _teams[0].team1.shift();
        if (_teams[0].team1.length == 0) {
            for (let i = 0; i < _teams[0].team1Reset.length; i++) {
                _teams[0].team1.push(_teams[0].team1Reset[i])
            }
        }
        _teams[0].currentPlayer = _teams[0].team1[0];
        innerHTML("currentPlayer","Current Player:<br><span style='color: lawngreen'>" + _teams[0].team1[0] + "</span>");
    } else {
        gameActivityLog("skipped " + _teams[0].team2[0],dateAndTime("log"));
        _teams[0].team2.shift();
        if (_teams[0].team2.length == 0) {
            for (let i = 0; i < _teams[0].team2Reset.length; i++) {
                _teams[0].team2.push(_teams[0].team2Reset[i])
            }
        }
        _teams[0].currentPlayer = _teams[0].team2[0];
        innerHTML("currentPlayer","Current Player:<br><span style='color: lawngreen'>" + _teams[0].team2[0] + "</span>");
    }
    storeNewData();
}

function deleteCurrentPlayer() {
    var log;
    if (_teams[0].currentTeam == 1) {
        if (_teams[0].team1Reset.length == 1) { 
            infoAlert("There must be at least one player on a team",["playGamePop"]);return
        }
        gameActivityLog("deleted " + _teams[0].team1[0] + " team 1",dateAndTime("log"));
        _teams[0].team1.shift();
        _teams[0].team1Reset.splice(_teams[0].team1Reset.length - _teams[0].team1.length - 1,1);
        if (_teams[0].team1.length == 0) {
            for (let i = 0; i < _teams[0].team1Reset.length; i++) {
                _teams[0].team1.push(_teams[0].team1Reset[i])
            }
        }
        _teams[0].currentPlayer = _teams[0].team1[0];
        innerHTML("currentPlayer","Current Player:<br><span style='color: lawngreen'>" + _teams[0].team1[0] + "</span>");
    } else {
        if (_teams[0].team2Reset.length == 1) { 
            infoAlert("There must be at least one player on a team",["playGamePop"]);return
        }
        gameActivityLog("deleted " + _teams[0].team2[0] + " team 2",dateAndTime("log"));
        _teams[0].team2.shift();
        _teams[0].team2Reset.splice(_teams[0].team2Reset.length - _teams[0].team2.length - 1,1);
        if (_teams[0].team2.length == 0) {
            for (let i = 0; i < _teams[0].team2Reset.length; i++) {
                _teams[0].team2.push(_teams[0].team2Reset[i])
            }
        }
        _teams[0].currentPlayer = _teams[0].team2[0];
        innerHTML("currentPlayer","Current Player:<br><span style='color: lawngreen'>" + _teams[0].team2[0] + "</span>");
    }
    populateTeams();
    storeNewData();
}

function addPlayer(x,i) {
    var log;
    if (x == 1) {
        _teams[0].team1.push(_sl[i].name[0]);
        _teams[0].team1Reset.push(_sl[i].name[0]);
        gameActivityLog("added " + _sl[i].name[0] + " team 1",dateAndTime("log"));
    } else {
        _teams[0].team2.push(_sl[i].name[0]);
        _teams[0].team2Reset.push(_sl[i].name[0]);
        gameActivityLog("added " + _sl[i].name[0] + " team 2",dateAndTime("log"));
    }
    populateTeams();
    storeNewData();
}

function assignStatsRanks(propertyName,index) {
    var pts = [];
    for (let i = 0; i < _sl.length; i++) {
        pts.push(_sl[i][propertyName]);
    } // creates an array of the points of each student in alphabetical order
    var ptsSorted = pts.slice().sort(function(a,b){return b - a}); // sorts the resuting array in numerical order
    var ptsRanked = pts.map(function(v){return ptsSorted.indexOf(v)+1}); // maps the index(+1) of each unique point value in the resulting array back to original array that was in alphabetical order
    for (let i = 0; i < _sl.length; i++) {
        _sl[i].statsRanks[index] = ptsRanked[i];
    } // assigns the values of the resulting array as the rank of each student
    sortSLbyProperty(propertyName); var repeats = 0;
    var corrected = []; corrected.push(_sl[0].statsRanks[index]);
    for (let i = 1; i < _sl.length; i++) {
        if (_sl[i].statsRanks[index] == _sl[i-1].statsRanks[index]) {
            repeats++;
            corrected.push(corrected[i-1]);
        } else {
            corrected.push(_sl[i].statsRanks[index] - repeats);
        }
    }
    for (let i = 1; i < _sl.length; i++) {
        _sl[i].statsRanks[index] = corrected[i];
    }
    sortSL();
    /* _sl is then sorted by rank.  An array of "corrected" ranks is created, and the first rank is pushed to it.  Now for every consecutive rank, if it's the same as the previous rank, a "repeat" is tallied, and the last value added to the "corrected" array is pushed to the array as a repeated rank.  If a consecutive rank is not the same as the previous rank, the rank is added to the "corrected" array after subtracting the current repeat tally from it.  This ensures no rank numbers are skipped, so instead of (for example) ranks [1,1,3,4,5,5,5,8,9,10], you get [1,1,2,3,4,4,4,5,6,7].  Finally, the current ranks are reassigned as the corrected ranks and _sl is sorted back into alphabetical order. */
}

function assignGameRanks() {
    var pts = [];
    for (let i = 0; i < _sl.length; i++) {
        pts.push(_sl[i].gamePts[0]);
    }
    var ptsSorted = pts.slice().sort(function(a,b){return b - a});
    var ptsRanked = pts.map(function(v){return ptsSorted.indexOf(v)+1});
    for (let i = 0; i < _sl.length; i++) {
        _sl[i].gamePts[1] = ptsRanked[i];
    }
    sortSLbyGamePts(); var repeats = 0;
    var corrected = []; corrected.push(_sl[0].gamePts[1]);
    for (let i = 1; i < _sl.length; i++) {
        if (_sl[i].gamePts[1] == _sl[i-1].gamePts[1]) {
            repeats++;
            corrected.push(corrected[i-1]);
        } else {
            corrected.push(_sl[i].gamePts[1] - repeats);
        }
    }
    for (let i = 1; i < _sl.length; i++) {
        _sl[i].gamePts[1] = corrected[i];
    }
    sortSL();
}

function setRankFactor() {
    if (_sl[_ci].rank[0] >= 9 && _sl[_ci].rank[0] < 15) {
        _sl[_ci].rank[1] = 1;
    } else if (_sl[_ci].rank[0] >= 15 && _sl[_ci].rank[0] < 19) {
        _sl[_ci].rank[1] = 2;
    } else if (_sl[_ci].rank[0] >= 19) {
        _sl[_ci].rank[1] = 3;
    } else {
        _sl[_ci].rank[1] = 0;
    }
}

function attCount() {
    var attCount = 0;
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].att) {
            attCount++;
        }
    }
    innerHTML("attCountButton",attCount);
    innerHTML("attCount",attCount);
    if (attCount > 0) {color("attCountButton","lawngreen")} else {color("attCountButton","#bbb")}
}

function ampmAttendance() {
    if (_disableAtt) {return};
    var attCount = 0;
    for (let i = 0; i < _sl.length; i++) {
        if (dateAndTime("hour") < 16 && _sl[i].att) {
            _sl[i].attArr[_ti][0] == 1; attCount++;
        } else if (dateAndTime("hour") >= 16 && _sl[i].att) {
            _sl[i].attArr[_ti][1] == 1; attCount++;
        }
    }
    if (dateAndTime("hour") < 16) {
        _att[_ti][0] = attCount;
    } else {
        _att[_ti][1] = attCount;
    }
    storeAndBackup();
}

function disableAtt() {
    if (!_disableAtt) {
        _disableAtt = true;
        innerHTML("lockButton","J");
        bgColor("lockButton","red");
        border("nameList",2,"solid","red");
    } else {
        _disableAtt = false;
        innerHTML("lockButton","K");
        bgColor("lockButton","black");
        if (_isClassDay) {
            border("nameList",2,"solid","lawngreen");
        } else {
            border("nameList",2,"solid","#222");
        }
    }
}

function loadAttendees() {
    attCount(); var boys = []; var girls = [];
    var ids = ["boysListAtt","girlsListAtt","boysListAttP","girlsListAttP"]
    for (let i = 0; i < ids.length; i++) {
        innerHTML(ids[i],"");
    }
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].gender == "M" && _sl[i].att) {
            boys.push(_sl[i]);
        } else if (_sl[i].gender == "F" && _sl[i].att) {
            girls.push(_sl[i]);
        }
    }
    for (let i = 0; i < boys.length; i++) {
        var p1 = createElement("p");
        p1.classList.add("name2");
        p1.innerHTML = boys[i].name[0];
        append("boysListAtt",p1);
    }  
    for (let i = 0; i < girls.length; i++) {
        var p2 = createElement("p");
        p2.classList.add("name2");
        p2.innerHTML = girls[i].name[0];
        append("girlsListAtt",p2);
    }  
    var allergies = false; document.getElementById("allergiesList").innerHTML = "";
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].allergies && _sl[i].att) {
            allergies = true;
            var p3 = createElement("p");
            var span1 = createElement("span");
            var span2 = createElement("span");
            span1.innerHTML = _sl[i].name[0] + "<br>";
            span2.innerHTML = _sl[i].allergies;
            span2.style.color = "#bbb";
            p3.append(span1,span2);
            append("allergiesList",p3);
        }
    }
    if (allergies) {
        display("allergiesContainer","block");
    } else {
        display("allergiesContainer","none");
    }
    innerHTML("boysListAttP","Boys (" + boys.length + ")");
    innerHTML("girlsListAttP","Girls (" + girls.length + ")");
    pop(["mainPop"],["attListPop"]);
}

function loadArchiveAttendees(index,time) {
    var boys = []; var girls = [];
    var ids = ["boysArchiveListAtt","girlsArchiveListAtt","boysArchiveListAttP","girlsArchiveListAttP"]
    for (let i = 0; i < ids.length; i++) {
        innerHTML(ids[i],"");
    }
    if (time == "AM") {
        for (let i = 0; i < _sl.length; i++) {
            if (_sl[i].gender == "M" && _sl[i].attArr[index][0] == 1) {
                boys.push(_sl[i].name[0]);
            } else if (_sl[i].gender == "F" && _sl[i].attArr[index][0] == 1) {
                girls.push(_sl[i].name[0]);
            }
        }
    } else {
        for (let i = 0; i < _sl.length; i++) {
            if (_sl[i].gender == "M" && _sl[i].attArr[index][1] == 1) {
                boys.push(_sl[i].name[0]);
            } else if (_sl[i].gender == "F" && _sl[i].attArr[index][1] == 1) {
                girls.push(_sl[i].name[0]);
            }
        }
    }
    for (let i = 0; i < boys.length; i++) {
        var p1 = createElement("p");
        p1.classList.add("name2");
        p1.innerHTML = boys[i];
        append("boysArchiveListAtt",p1);
    }  
    for (let i = 0; i < girls.length; i++) {
        var p2 = createElement("p");
        p2.classList.add("name2");
        p2.innerHTML = girls[i];
        append("girlsArchiveListAtt",p2);
    }  
    innerHTML("boysArchiveListAttP","Boys (" + boys.length + ")");
    innerHTML("girlsArchiveListAttP","Girls (" + girls.length + ")");
    innerHTML("attArchiveCount",boys.length + girls.length);
    innerHTML("attArchiveDate",cdn(_dns[index]) + " " + time + " Attendance");
    pop(["attStatsPop"],["attArchiveListPop"]);
}

function resetAtt() {
    for (let i = 0; i < _sl.length; i++) {
        _sl[i].att = false;
        if (_isClassDay) {
            if (dateAndTime("hour") < 16) {
                _sl[i].attArr[_ti][0] = 0;
            } else {
                _sl[i].attArr[_ti][1] = 0;
            }
        }
    }
    if (_isClassDay) {
        if (dateAndTime("hour") < 16) {
            _att[_ti][0] = 0;
        } else {_att[_ti][1] = 0}
    }
    activityLog("removed all attendees",dateAndTime("log"));
    if (_isClassDay) {ampmAttendance()}
    attCount(); storeAndBackup(); goHome();
}

function clearAttendees() {
    for (let i = 0; i < _sl.length; i++) {
        _sl[i].att = false;
    }
}

function att2(i) {
    _sl[i].att = true;
    if (_isClassDay) {
        if (dateAndTime("hour") < 16) {
            _sl[i].attArr[_ti][0] = 1;
        } else {
            _sl[i].attArr[_ti][1] = 1;
        } 
        ampmAttendance()
    }
    activityLog("added attendee " + _sl[i].name[0],dateAndTime("log"));
    attCount(); storeNewData();
}

function randAtt(blank,x) {
    if (x > _sl.length) {
        x = _sl.length;
    }
    for (let i = 0; i < _sl.length; i++) {
        _sl[i].att = false;
    }
    for (let i = 0; i < x; i++) {
        let x = Math.floor(Math.random() * _sl.length);
        if (!_sl[x].att) {
            _sl[x].att = true;
        } else {
            i--
        }
    }
    if (_isClassDay && dateAndTime("hour") < 16) {
        for (let i = 0; i < _sl.length; i++) {
            if (_sl[i].att) {
                _att[_ti][0] += 1;
                _sl[i].attArr[_ti][0] = 1;
            }
        } 
    } else if (_isClassDay && dateAndTime("hour") >= 16) {
        for (let i = 0; i < _sl.length; i++) {
            if (_sl[i].att) {
                _att[_ti][1] += 1;
                _sl[i].attArr[_ti][1] = 1;
            }
        } 
    }
    loadAttendees(); attCount(); populateNames(); storeAndBackup();
}

function sortByRank() {
    innerHTML("nameListCustom","");
    display("nameListCustom","block");
    display("genderListContainer","none");
    _sl.sort(function(b,a){return a.rank[0] - b.rank[0]});
    for (let i = 0; i < _sl.length; i++) {
        var lastElementNode;
        var p = createElement("p");
        var span1 = createElement("span");
        var span2 = createElement("span");
        span1.classList.add("sortValues");
        p.classList.add("name3");
        if (_sl[i].rank[0] != lastElementNode) {
            p.style.borderTop = "2px solid #555";
            p.style.paddingTop = "10px";
        }
        span1.innerHTML = _rankNamesShort[_sl[i].rank[0]];
        span2.innerHTML = " " + _sl[i].name[0];
        p.append(span1,span2);
        append("nameListCustom",p);
        lastElementNode = _sl[i].rank[0];
    }
    customSortListPop("sortChoicePop","Rank");
}

function sortByPts(lb) {
    if (lb) {
        innerHTML("totalPtsLbList","");
    } else {
        innerHTML("nameListCustom","");
        display("nameListCustom","block");
        display("genderListContainer","none");
    }
    var totalASpts = 0; var totalMVpts = 0;
    if (_ew > 1) {
        for (let i = 0; i < _ti; i++) {
            if (i > 31) {break}
            totalASpts += _asMaxPts[i];
            totalMVpts += _mvMaxPts[i];
        }
    }
    var totalPts = totalASpts + totalMVpts;
    assignStatsRanks("pts",0);
    _sl.sort(function(b,a){return a.pts - b.pts});
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].pts == 0) {continue}
        if (lb) {if ( _sl[i].statsRanks[0] > 10 ) {continue}}
        var totalPtsPercentage = ((_sl[i].pts / totalPts) * 100).toFixed(1);
        var lastElementNode;
        var p = createElement("p");
        var span1 = createElement("span");
        var span2 = createElement("span");
        p.classList.add("name3");
        span2.classList.add("sortValues");
        if (_sl[i].pts != lastElementNode) {
            p.style.borderTop = "2px solid #555";
            p.style.paddingTop = "10px";
        }
        span1.innerHTML = _sl[i].statsRanks[0] + ". " + _sl[i].name[0];
        span2.innerHTML = " " + _sl[i].pts + "/" + totalPts + " (" + totalPtsPercentage + "%)";
        if (lb) {if (_sl[i].name[0] == _currentStudent) {span1.style.color = "lawngreen"}}
        p.append(span1,span2);
        if (lb) {
            append("totalPtsLbList",p);
        } else {
            append("nameListCustom",p);
        }
        lastElementNode = _sl[i].pts;
    }
    if (!lb) {customSortListPop("sortChoicePop","Total Points")}
}

function sortByGamePts() {
    assignGameRanks(); innerHTML("nameListCustom","");
    display("nameListCustom","block"); display("genderListContainer","none");
    _sl.sort(function(b,a){return a.gamePts[0] - b.gamePts[0]});
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].gamePts[0] == 0) {continue}
        if (_sl[i].gamePts[1] > 3) {break}
        var lastElementNode;
        var p = createElement("p");
        p.classList.add("name3");
        if (_sl[i].gamePts[0] != lastElementNode) {
            p.style.borderTop = "2px solid #555";
            p.style.paddingTop = "10px";
        }
        p.innerHTML = _sl[i].gamePts[1] + ". " + _sl[i].name[0] + " (" + _sl[i].gamePts[0] + ")";
        append("nameListCustom",p);
        lastElementNode = _sl[i].gamePts[0];
    }
    customSortListPop("teamsListPop","Game Points");
}

function sortByASpts(lb) {
    if (lb) {
        innerHTML("asPtsLbList","");
    } else {
        innerHTML("nameListCustom","");
        display("nameListCustom","block");
        display("genderListContainer","none");
    }
    var totalASpts = 0;
    if (_ew > 1) {
        for (let j = 0; j < _ti; j++) {
            if (j > 31) {break}
            totalASpts += _asMaxPts[j];
        }
    }
    for (let i = 0; i < _sl.length; i++) {
        var earnedASpts = 0; var asPercentage;
        if (_ew > 1) {
            for (let j = 0; j < _ti; j++) {
                if (j > 31) {break}
                earnedASpts += _sl[i].as[j][0];
            }
        }
        if (_ew > 1) {
            asPercentage = ((earnedASpts / totalASpts) * 100).toFixed(1);
        } else {
            asPercentage = 0;
        }
        _sl[i].earnedASpts = earnedASpts;
        _sl[i].asPercentage = asPercentage;
    }
    assignStatsRanks("earnedASpts",1);
    _sl.sort(function(b,a){return a.earnedASpts - b.earnedASpts});
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].earnedASpts == 0) {continue}
        if (lb) {if ( _sl[i].statsRanks[1] > 10 ) {continue}}
        var lastElementNode;
        var p = createElement("p");
        var span1 = createElement("span");
        var span2 = createElement("span");
        if (lb) {if (_sl[i].name[0] == _currentStudent) {span1.style.color = "lawngreen"}}
        span2.classList.add("sortValues");
        p.classList.add("name3");
        if (_sl[i].earnedASpts != lastElementNode) {
            p.style.borderTop = "2px solid #555";
            p.style.paddingTop = "10px";
        }
        span1.innerHTML = _sl[i].statsRanks[1] + ". " + _sl[i].name[0];
        span2.innerHTML = " " + _sl[i].earnedASpts + "/" + totalASpts + " (" + _sl[i].asPercentage + "%)";
        p.append(span1,span2);
        if (lb) {
            append("asPtsLbList",p);
        } else {
            append("nameListCustom",p);
        }        lastElementNode = _sl[i].earnedASpts;
    }
    if (!lb) {customSortListPop("sortChoicePop","Activity Points")}
}

function sortByMVpts(lb) {
    if (lb) {
        innerHTML("mvPtsLbList","");
    } else {
        innerHTML("nameListCustom","");
        display("nameListCustom","block");
        display("genderListContainer","none");
    }
    var totalMVpts = 0;
    if (_ew > 1) {
        for (let j = 0; j < _ti; j++) {
            if (j > 31) {break}
            totalMVpts += _mvMaxPts[j];
        }
    }
    for (let i = 0; i < _sl.length; i++) {
        var earnedMVpts = 0; var mvPercentage;
        if (_ew > 1) {
            for (let j = 0; j < _ti; j++) {
                if (j > 31) {break}
                earnedMVpts += _sl[i].mv[j][0];
            }
        }
        if (_ew > 1) {
            mvPercentage = ((earnedMVpts / totalMVpts) * 100).toFixed(1);
        } else {
            mvPercentage = 0;
        }
        _sl[i].earnedMVpts = earnedMVpts;
        _sl[i].mvPercentage = mvPercentage;
    }
    assignStatsRanks("earnedMVpts",2);
    _sl.sort(function(b,a){return a.earnedMVpts - b.earnedMVpts});
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].earnedMVpts == 0) {continue}
        if (lb) {if ( _sl[i].statsRanks[2] > 10 ) {continue}}
        var lastElementNode;
        var p = createElement("p");
        var span1 = createElement("span");
        var span2 = createElement("span");
        if (lb) {if (_sl[i].name[0] == _currentStudent) {span1.style.color = "lawngreen"}}
        span2.classList.add("sortValues");
        p.classList.add("name3");
        if (_sl[i].earnedMVpts != lastElementNode) {
            p.style.borderTop = "2px solid #555";
            p.style.paddingTop = "10px";
        }
        span1.innerHTML = _sl[i].statsRanks[2] + ". " + _sl[i].name[0];
        span2.innerHTML = " " + _sl[i].earnedMVpts + "/" + totalMVpts + " (" + _sl[i].mvPercentage + "%)";
        p.append(span1,span2);
        if (lb) {
            append("mvPtsLbList",p);
        } else {
            append("nameListCustom",p);
        }        lastElementNode = _sl[i].earnedMVpts;
    }
    if (!lb) {customSortListPop("sortChoicePop","Memory Points")}
}

function sortByAtt(lb) {
    if (lb) {
        innerHTML("attLbList","");
    } else {
        innerHTML("nameListCustom","");
        display("nameListCustom","block");
        display("genderListContainer","none");
    }
    for (let i = 0; i < _sl.length; i++) {
        var amTotal = []; var pmTotal = []
        for (let j = 0; j < _ew; j++) {
            amTotal.push(_sl[i].attArr[j][0]);
            pmTotal.push(_sl[i].attArr[j][1]);
        }
        var total = sumArrays([amTotal,pmTotal]);
        for (let j = 0; j < _ew; j++) {
            if (_sl[i].attArr[j][0] == 1 && _sl[i].attArr[j][1] == 1) {
                total--
            }
        }
        _sl[i].totalWksAtt = total;
    }
    assignStatsRanks("totalWksAtt",3);
    _sl.sort(function(a,b){return b.totalWksAtt - a.totalWksAtt});
    for (let i = 0; i < _sl.length; i++) {
        if (lb) {if ( _sl[i].statsRanks[3] > 10 ) {continue}}
        var lastElementNode;
        var attPercentage = ((_sl[i].totalWksAtt / _ew) * 100).toFixed(1);
        var p = createElement("p");
        var span1 = createElement("span");
        var span2 = createElement("span");
        span2.classList.add("sortValues");
        p.classList.add("name3");
        p.classList.add("name3");
        if (_sl[i].totalWksAtt != lastElementNode) {
            p.style.borderTop = "2px solid #555";
            p.style.paddingTop = "10px";
        }
        span1.innerHTML = _sl[i].statsRanks[3] + ". " + _sl[i].name[0];
        span2.innerHTML = " " + _sl[i].totalWksAtt + "/" + _ew + " (" + attPercentage + "%)";
        if (lb) {if (_sl[i].name[0] == _currentStudent) {span1.style.color = "lawngreen"}}
        p.append(span1,span2);
        if (lb) {
            append("attLbList",p);
        } else {
            append("nameListCustom",p);
        }        lastElementNode = _sl[i].totalWksAtt;
    }  
    if (!lb) {customSortListPop("sortChoicePop","Attendance")}
}

function sortByTP(lb) {
    if (lb) {
        innerHTML("tpLbList","");
    } else {
        innerHTML("nameListCustom","");
        display("nameListCustom","block");
        display("genderListContainer","none");
    }
    var totalASpts = 0; var totalMVpts = 0;
    if (_ew > 1) {
        for (let j = 0; j < _ti; j++) {
            if (j > 31) {break}
            totalASpts += _asMaxPts[j];
            totalMVpts += _mvMaxPts[j];
        }
    }
    var totalTPpts = totalASpts + totalMVpts + _ew;
    for (let i = 0; i < _sl.length; i++) {
        var amTotal = []; var pmTotal = []
        for (let j = 0; j < _ew; j++) {
            amTotal.push(_sl[i].attArr[j][0]);
            pmTotal.push(_sl[i].attArr[j][1]);
        }
        var total = sumArrays([amTotal,pmTotal]);
        for (let j = 0; j < _ew; j++) {
            if (_sl[i].attArr[j][0] == 1 && _sl[i].attArr[j][1] == 1) {
                total--
            }
        }
        _sl[i].tpPts = _sl[i].pts + total;
    }
    assignStatsRanks("tpPts",4);
    _sl.sort(function(a,b){return b.tpPts - a.tpPts});
    for (let i = 0; i < _sl.length; i++) {
        if (lb) {if ( _sl[i].statsRanks[4] > 10 ) {continue}}
        var lastElementNode;
        var tpPercentage = ((_sl[i].tpPts / totalTPpts) * 100).toFixed(1);
        var p = createElement("p");
        var span1 = createElement("span");
        var span2 = createElement("span");
        if (lb) {if (_sl[i].name[0] == _currentStudent) {span1.style.color = "lawngreen"}}
        span2.classList.add("sortValues");
        p.classList.add("name3");
        p.classList.add("name3");
        if (_sl[i].tpPts != lastElementNode) {
            p.style.borderTop = "2px solid #555";
            p.style.paddingTop = "10px";
        }
        span1.innerHTML = _sl[i].statsRanks[4] + ". " + _sl[i].name[0];
        span2.innerHTML = " " + _sl[i].tpPts + "/" + totalTPpts + " (" + tpPercentage + "%)";
        p.append(span1,span2);
        if (lb) {
            append("tpLbList",p);
        } else {
            append("nameListCustom",p);
        }
        lastElementNode = _sl[i].tpPts;
    }  
    if (!lb) {customSortListPop("sortChoicePop","Participation")}
}

function sortByGender() {
    var boys = []; var girls = [];
    display("nameListCustom","none");
    innerHTML("boysList","");
    innerHTML("girlsList","");
    display("genderListContainer","flex");
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].gender == "M") {
            boys.push(_sl[i].name[0]);
        } else {
            girls.push(_sl[i].name[0]);
        }
    }
    for (let i = 0; i < boys.length; i++) {
        var p1 = createElement("p");
        p1.classList.add("name2");
        p1.innerHTML = boys[i];
        append("boysList",p1);
    }  
    for (let i = 0; i < girls.length; i++) {
        var p2 = createElement("p");
        p2.classList.add("name2");
        p2.innerHTML = girls[i];
        append("girlsList",p2);
    }  
    innerHTML("boysListP","Boys (" + boys.length + ")");
    innerHTML("girlsListP","Girls (" + girls.length + ")");
    customSortListPop("sortChoicePop","Gender");
}

function sortByBd() {
    innerHTML("nameListCustom","");
    display("nameListCustom","block");
    display("genderListContainer","none");
    var bdnOrder = _sl.sort(function(a,b){return a.bd[0] - b.bd[0]});
    for (let i = 0; i < _sl.length; i++) {
        if (bdnOrder[i].bd[0] == 0) { continue }
        var lastElementNode;
        var p = createElement("p");
        var span1 = createElement("span");
        var span2 = createElement("span");
        p.classList.add("name3");
        span1.classList.add("sortValues");
        if (cdn(_sl[i].bd[0],"M") != lastElementNode) {
            p.style.borderTop = "2px solid #333";
            p.style.paddingTop = "10px";
        }
        if (_sl[i].bd[2]) {
            span1.style.textDecoration = "line-through";
            span2.style.textDecoration = "line-through";
            span2.style.color = "#bbb"
        };
        span1.innerHTML = cdn(bdnOrder[i].bd[0]);
        span2.innerHTML = " " + bdnOrder[i].name[0];
        p.append(span1,span2); append("nameListCustom",p);
        lastElementNode = cdn(_sl[i].bd[0],"M");
    }  
    customSortListPop("sortChoicePop","Birthdays");
}

function sortByDateAdded() {
    innerHTML("nameListCustom","");
    display("nameListCustom","block");
    display("genderListContainer","none");
    var dateAddedOrder = _sl.sort(function(a,b){return a.dateAdded - b.dateAdded});
    for (let i = 0; i < _sl.length; i++) {
        var dateAddedMonth; var dateAddedDate;
        var dateAddedArray = cdn(_sl[i].dateAdded).split("/");
        dateAddedMonth = dateAddedArray[0]; dateAddedDate = dateAddedArray[1];
        var lastElementNode;
        var p = createElement("p");
        var span1 = createElement("span");
        var span2 = createElement("span");
        p.classList.add("name3");
        span1.classList.add("sortValues");
        if (dateAddedDate != lastElementNode) {
            p.style.borderTop = "2px solid #333";
            p.style.paddingTop = "10px";
        }
        span1.innerHTML = dateAddedMonth + "/" + dateAddedDate;
        span2.innerHTML = " " + dateAddedOrder[i].name[0];
        p.append(span1,span2); append("nameListCustom",p);
        lastElementNode = dateAddedDate;
    }  
    customSortListPop("sortChoicePop","Date Added");
}

function sortByNotes() {
    innerHTML("nameListCustom","");
    display("nameListCustom","block");
    display("genderListContainer","none");
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].notes != false) {
            var lastElementNode;
            var p1 = createElement("p");
            var br = createElement("br");
            var p2 = createElement("p");
            p1.classList.add("name3");
            p2.classList.add("sortValues");
            if (_sl[i] != lastElementNode) {
                p1.style.borderTop = "2px solid #333";
                p1.style.paddingTop = "10px";
            }
            p1.innerHTML = _sl[i].name[0];
            var notesString = "";
            for (let j = 0; j < _sl[i].notes.length; j++) {
                if (j < (_sl[i].notes.length-1)) {
                    notesString += (j+1) + ". " + _sl[i].notes[j] + "<br>"
                } else {
                    notesString += (j+1) + ". " + _sl[i].notes[j];
                }
            }
            p1.append(br);
            p2.innerHTML = notesString;
            p1.append(p2);
            append("nameListCustom",p1);
            lastElementNode = _sl[i];
        }
    }  
    customSortListPop("sortChoicePop","Notes")
}

function sortByAllergies() {
    innerHTML("allergiesList","");
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].allergies && _sl[i].att) {
            var lastElementNode;
            var p1 = createElement("p");
            var br = createElement("br");
            var p2 = createElement("p");
            p1.classList.add("name3");
            p2.classList.add("sortValues");
            if (_sl[i] != lastElementNode) {
                p1.style.borderTop = "2px solid #333";
                p1.style.paddingTop = "10px";
            }
            p1.innerHTML = _sl[i].name[0];
            p1.append(br);
            p2.innerHTML = _sl[i].allergies;
            p1.append(p2);
            append("allergiesList",p1);
            lastElementNode = _sl[i];
        }
    }  
}

function sortSL() {
    _sl.sort(function(a,b) {
        var textA = a.name[0].split(" ")[1].toLowerCase(); // last name A
        var textB = b.name[0].split(" ")[1].toLowerCase(); // last name B
        return (textA < textB) ? -1 : (textA > textB) ? 1 : 0;
    }); // sorts by last name
    _sl.sort(function(a,b) {
        var textA1 = a.name[0].split(" ")[1].toLowerCase(); // last name A
        var textB1 = b.name[0].split(" ")[1].toLowerCase(); // last name B
        var textA0 = a.name[0].split(" ")[0].toLowerCase(); // first name A
        var textB0 = b.name[0].split(" ")[0].toLowerCase(); // first name B
        if (textA1 == textB1) {
            return (textA0 < textB0) ? -1 : (textA0 > textB0) ? 1 : 0;
        }
    }); // then sorts students with the same last name by their first name
    populateNames();
}

function sortSLbyProperty(propertyName) {
    _sl.sort(function(a,b) {
            var textA = a[propertyName];
            var textB = b[propertyName];
            return (textA < textB) ? 1 : (textA > textB) ? -1 : 0;
    });
}

function sortSLbyGamePts() {
    _sl.sort(function(a,b) {
            var textA = a.gamePts[0];
            var textB = b.gamePts[0];
            return (textA < textB) ? 1 : (textA > textB) ? -1 : 0;
    });
}

function populateNotes() {
    innerHTML("notesList","");
    for (let i = 0; i < _sl[_ci].notes.length; i++) {
        if (_sl[_ci].notes[i] == false) { continue }
        var p1 = createElement("p");
        p1.classList.add("note");
        (function(i){
            p1.onclick = function () {
                pop(["notesPop"],["editNotePop","editNote"]);
                idFocus("editNote");
                _noteIndex = i;
                value("editNote",_sl[_ci].notes[_noteIndex]);
            }
        })(i);
        p1.innerHTML = (i + 1) + ". " + _sl[_ci].notes[i];
        append("notesList",p1);
    }
    var p2 = createElement("p");
    p2.classList.add("addNew");
    p2.onclick = function () {
        pop(["notesPop"],["addNotePop","addNote"]);
        idFocus("addNote");
    }
    p2.innerHTML = "Add New Note";
    append("notesList",p2);
}

function addNote() {
    var note = document.getElementById("addNote").value.trim();
    if (note === null || note == "") {
        return
    } else {
        _sl[_ci].notes.push(note);
        value("addNote","");
        storeAndBackup();
        populateNotes();
        pop(["addNotePop","addNote"],["notesPop","notesList"]);
    }
    activityLog("added note to "+_sl[_ci].name[0],"\""+_sl[_ci].notes[_sl[_ci].notes.length-1]+"\"",dateAndTime("log"));
}

function addReminder() {
    var note = document.getElementById("addReminder").value.trim();
    if (note === null || note == "") {
        return
    } else {
        _reminders.push(note);
        value("addReminder","");
        storeAndBackup(); populateReminders(); allAlerts();
        pop(["addReminderPop","addReminder"],["remindersPop","remindersList"]);
    }
    activityLog("added reminder","\""+_reminders[_reminders.length-1]+"\"",dateAndTime("log"));
}

function deleteNote() {
    activityLog("deleted note for "+_sl[_ci].name[0],"\""+_sl[_ci].notes[_noteIndex]+"\"",dateAndTime("log"));
    _sl[_ci].notes.splice(_noteIndex,1);
    storeAndBackup();
    populateNotes();
    pop(["editNotePop"],["notesPop"]);
}

function editNote() {
    var a = _sl[_ci].notes[_noteIndex];
    if (document.getElementById("editNote").value == "") {
        _sl[_ci].notes.splice(_noteIndex,1);
        if (_sl[_ci].notes.length == 0) {
            bgColor("notesButton","black");
        }
    } else {
        _sl[_ci].notes[_noteIndex] = document.getElementById("editNote").value.trim();
    }
    activityLog("edited note for "+_sl[_ci].name[0],"\""+a+"\" --> \""+_sl[_ci].notes[_noteIndex]+"\"",dateAndTime("log"));
    storeAndBackup();
    populateNotes();
    pop(["editNotePop"],["notesPop"]);
}

function findAllBds() {
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].bd[0] >= _todaysDn && _sl[i].bd[0] <= (_todaysDn + (6 + (7 * _weeksOff))) && !_sl[i].bd[1]) {
            _sl[i].bd[1] = true;
            activityLog(_sl[i].name[0] + " birthday found (" + cdn(_sl[i].bd[0]) + ")",dateAndTime("log"));
        }
    }
}

function findBd() {
    if (_sl[_ci].bd[0] >= _todaysDn && _sl[_ci].bd[0] <= (_todaysDn + (6 + (7 * _weeksOff))) && !_sl[_ci].bd[1] && !_sl[_ci].bd[2]) {
        _sl[_ci].bd[1] = true;
        activityLog(_sl[_ci].name[0] + " birthday found (" + cdn(_sl[_ci].bd[0]) + ")",dateAndTime("log"));
    }
}

function capitalize(x) {
    return x.charAt(0).toUpperCase() + x.slice(1);
}

function shuffleArray(array) {
    for (var i = array.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
}

function activityLog(textA,textB,textC) {
    var p = createElement("p");
    var span1 = createElement("span");
    var span2 = createElement("span"); span2.style.color = "#bbb";
    var br1 = createElement("br");
    var br2 = createElement("br");
    span1.innerHTML = textA; span2.innerHTML = textB; 
    p.classList.add("logEntry");
    span1.classList.add("logSpan");
    if (textC) {
        var span3 = createElement("span"); span3.style.color = "#bbb"
        span3.innerHTML = textC;
        p.append(span1,br1,span2,br2,span3)
    } else {p.append(span1,br1,span2)}
    append("log",p);
    _log = document.getElementById("log").innerHTML;
    storeNewData();
}

function infoAlert(message,idArray,focus,noImage,fontSize,textAlign) {
    if (document.getElementById("infoAlertPop").style.display == "block") {
        display("infoAlertPop","none");
        for (let i = 0; i < _currentPops.length; i++) {
            if (_currentPops[i] !== null) {
                display(_currentPops[i],"block");
            }
        }
        innerHTML("infoAlertMessage","");
    } else if (document.getElementById("infoAlertPop").style.display != "block") {
        _currentPops = idArray;
        _focus = focus;
        display("infoAlertPop","block");
        for (let i = 0; i < _currentPops.length; i++) {
            if (_currentPops[i] !== null) {
                display(_currentPops[i],"none");
            }
        }
        innerHTML("infoAlertMessage",message);
    }
    if (_focus) {idFocus(_focus)}
    if (noImage) {display("infoAlertTitle","none")} else {display("infoAlertTitle","block")}
    if (fontSize) {idFontSize("infoAlertMessage",fontSize)} else {idFontSize("infoAlertMessage",30)}
    if (textAlign) {
        document.getElementById("infoAlertMessage").style.textAlign = textAlign;
    } else {
        document.getElementById("infoAlertMessage").style.textAlign = "center";
    }
}

function dataInputAlert(message,popArray,func,parameter,bypass) {
    if (document.getElementById("dataInputAlertPop").style.display != "block") {
        _dataInputParameter = parameter;
        _currentPops2 = popArray;
        _currentFunction = func;
        display("dataInputAlertPop","block");
        value("dataInputTF","");
        for (let i = 0; i < _currentPops2.length; i++) {
            document.getElementById(_currentPops2[i]).style.display = "none"
        }
        innerHTML("dataInputAlertMessage",message);
        idFocus("dataInputTF");
    } else if (document.getElementById("dataInputAlertPop").style.display == "block") {
        if (!bypass) {
            if (isNaN(parseInt(document.getElementById("dataInputTF").value))) {
                infoAlert("Please enter a number",["dataInputAlertPop"],"dataInputTF");return
            }
            var data = parseInt(document.getElementById("dataInputTF").value);
            _currentFunction(_dataInputParameter,data);
            for (let i = 0; i < _currentPops2.length; i++) {
                display(_currentPops2[i],"block");
            }
            innerHTML("dataInputAlertMessage","");
            display("dataInputAlertPop","none");
        } else {
            display("dataInputAlertPop","none");
            for (let i = 0; i < _currentPops2.length; i++) {
                display(_currentPops2[i],"block");
            }
        }
    }
}

function actionAlert(message,popsArray,func,bypass,parameter) {
    if (document.getElementById("actionAlertPop").style.display != "block") {
        _currentPops = popsArray; _currentFunction = func; _currentParameter= parameter;
        display("actionAlertPop","block");
        for (let i = 0; i < _currentPops.length; i++) {
            if (_currentPops[i] !== undefined) {
                display(_currentPops[i],"none");
            }
        }
        innerHTML("actionAlertMessage",message);
    } else if (document.getElementById("actionAlertPop").style.display == "block") {
        display("actionAlertPop","none");
        for (let i = 0; i < _currentPops.length; i++) {
            if (_currentPops[i] !== undefined) {
                display(_currentPops[i],"block");
            }
        }
        innerHTML("actionAlertMessage","");
        if (!bypass) {
            _currentFunction(_currentParameter);
        }
    } 
}

function proofDate(month,date) {
    if (month == 0 || date == 0) {return false}
    var months = [1,2,3,4,5,6,7,8,9,10,11,12];
    var dates = [31,29,31,30,31,30,31,31,30,31,30,31];
    if (month != "" && date != "") {
        if (months.indexOf(month) < 0 || date > dates[month-1] || isNaN(date)) {
            return false;
        } else {return true}
    }
}

function newStudent() {
    var NFNArray; var NLNArray;
    if (document.getElementById("newFirst").value.trim().indexOf(" ") > -1) {
        NFNArray = (document.getElementById("newFirst").value.trim().toLowerCase()).split(" ");
    } else if (document.getElementById("newFirst").value.trim().indexOf("-") > -1) {
        NFNArray = (document.getElementById("newFirst").value.trim().toLowerCase()).split("-");
    } else {
        NFNArray = [(document.getElementById("newFirst").value.trim().toLowerCase())];
    }
    if (document.getElementById("newLast").value.trim().indexOf(" ") > -1) {
        NLNArray = (document.getElementById("newLast").value.trim().toLowerCase()).split(" ");
    } else if (document.getElementById("newLast").value.trim().indexOf("-") > -1) {
        NLNArray = (document.getElementById("newLast").value.trim().toLowerCase()).split("-");
    } else {
        NLNArray = [(document.getElementById("newLast").value.trim().toLowerCase())];
    }
    if (NFNArray == false || NLNArray == false) {
        infoAlert("First and last name required",["newStudentPop"]);return
    } else {
        for (let i = 0; i < NFNArray.length; i++) {
            NFNArray[i] = capitalize(NFNArray[i]);
        }
        for (let i = 0; i < NLNArray.length; i++) {
            NLNArray[i] = capitalize(NLNArray[i]);
        }
        var newFirst = NFNArray.join("-"); var newLast = NLNArray.join("-");
        var pron = document.getElementById("newNamePron").value.trim();
    }
    var newGender = document.getElementById("newGender").value.trim();
    if (typeof newGender === "string" && newGender.toLowerCase() == "m") {
        newGender = "M";
    } else if (typeof newGender === "string" && newGender.toLowerCase() == "f") {
        newGender = "F";
    } else {
        infoAlert("Please enter 'M' or 'F' for gender",["newStudentPop"]);return
    }
    var newbdMonth = document.getElementById("newbdMonth").value.trim();
    var newbdDate = document.getElementById("newbdDate").value.trim();
    if (newbdMonth === "" && newbdDate === "") {
        newbdMonth = 0; newbdDate = 0;
    } else {
        if (!proofDate(parseInt(newbdMonth),parseInt(newbdDate)) || newbdMonth === 0 || newbdDate === 0 || isNaN(parseInt(newbdMonth)) || isNaN(parseInt(newbdDate))) {
            infoAlert("Invalid birthday date",["newStudentPop"]);return
        }
    }
    var newStudent = new Student();
    _sl.push(newStudent); _ci = _sl.length-1;
    _sl[_ci].name = [newFirst + " " + newLast,pron];
    _sl[_ci].gender = newGender;
    _sl[_ci].bd = [assignDn(parseInt(newbdMonth),parseInt(newbdDate)),false,false,0];
    _sl[_ci].email = document.getElementById("newEmail").value.toLowerCase().trim();
    _sl[_ci].allergies = document.getElementById("newAllergies").value.toLowerCase().trim();
    document.getElementById("initialNote").value != false ? _sl[_ci].notes = [document.getElementById("initialNote").value.trim()] : _sl[_ci].notes = [];
    for (let i = 0; i < _dns.length; i++) {
        newStudent.attArr[i] = [0,0];
    }
    for (let i = 0; i < _asNames.length; i++) {
        newStudent.as[i] = [0,0];
    }
    for (let i = 0; i < _mvNames.length; i++) {
        newStudent.mv[i] = [0,0];
    }
    newStudent.promoDns[0] = _todaysDn;
    for (let i = 1; i < _rankNames.length-1; i++) {
        newStudent.promoDns[i] = 0;
    }
    if (_isClassDay) {
        if (dateAndTime("hour") < 16) {
            newStudent.attArr[_ti][0] = 1;
        } else if (dateAndTime("hour") >= 16) {
            newStudent.attArr[_ti][1] = 1;
        } ampmAttendance();
    }
    activityLog("new student " + _sl[_ci].name[0],dateAndTime("log"));
    assignPin(_ci); attCount(); findBd(); sortSL(); storeAndBackup(); clearStudentFields();
    if (document.getElementById("rapidEntryCheck").checked) {
        idFocus("newFirst");return
    } else {
        goHome();
    }
}

function deleteStudent() {
    activityLog("deleted student "+_sl[_ci].name[0],dateAndTime("log"));
    _sl.splice(_ci,1);
    if (_isClassDay) {ampmAttendance()};
    attCount(); storeAndBackup(); sortSL(); goHome();
}

function editStudent() {
    var original = [_sl[_ci].name[0].toString(),_sl[_ci].gender,cdn(_sl[_ci].bd[0]),_sl[_ci].email,_sl[_ci].name[1].toString(),_sl[_ci].allergies];
    var EFNArray; var ELNArray;
    if (document.getElementById("editFirst").value.trim().indexOf(" ") > -1) {
        var EFNArray = (document.getElementById("editFirst").value.trim().toLowerCase()).split(" ");
    } else if (document.getElementById("editFirst").value.trim().indexOf("-") > -1) {
        var EFNArray = (document.getElementById("editFirst").value.trim().toLowerCase()).split("-");
    } else {
        var EFNArray = [(document.getElementById("editFirst").value.trim().toLowerCase())];
    }
    if (document.getElementById("editLast").value.trim().indexOf(" ") > -1) {
        var ELNArray = (document.getElementById("editLast").value.trim().toLowerCase()).split(" ");
    } else if (document.getElementById("editLast").value.trim().indexOf("-") > -1) {
        var ELNArray = (document.getElementById("editLast").value.trim().toLowerCase()).split("-");
    } else {
        var ELNArray = [(document.getElementById("editLast").value.trim().toLowerCase())];
    }
    var editGender = document.getElementById("editGender").value.trim();
    if (typeof editGender === "string" && editGender.toLowerCase() == "m") {
        _sl[_ci].gender = "M";
    } else if (typeof editGender === "string" && editGender.toLowerCase() == "f") {
        _sl[_ci].gender = "F";
    } else {
        infoAlert("Please enter 'M' or 'F' for gender",["editStudentPop"]);return
    }
    var editBdMonth = document.getElementById("editBdMonth").value.trim();
    var editBdDate = document.getElementById("editBdDate").value.trim();
    if (editBdMonth === "" && editBdDate === "") {
        var editBdMonth = 0; var editBdDate = 0;
    } else {
        if (!proofDate(parseInt(editBdMonth),parseInt(editBdDate)) || editBdMonth === 0 || editBdDate === 0 || isNaN(parseInt(editBdMonth)) || isNaN(parseInt(editBdDate))) {
            infoAlert("Invalid birthday date",["editStudentPop"]);return
        }
    }
    _sl[_ci].bd = [assignDn(parseInt(editBdMonth),parseInt(editBdDate)),false,false,0];
    _sl[_ci].name[1] = document.getElementById("editNamePron").value.trim();
    _sl[_ci].email = document.getElementById("editEmail").value.toLowerCase().trim();
    _sl[_ci].allergies = document.getElementById("editAllergies").value.toLowerCase().trim();
    if (EFNArray == false || ELNArray == false) {
        infoAlert("First and last name required",["editStudentPop"]);return
    } else {
        for (let i = 0; i < EFNArray.length; i++) {
            EFNArray[i] = capitalize(EFNArray[i]);
        }
        for (let i = 0; i < ELNArray.length; i++) {
            ELNArray[i] = capitalize(ELNArray[i]);
        }
        var first = EFNArray.join("-");
        var last = ELNArray.join("-");
        _sl[_ci].name[0] = first + " " + last;
    }
    innerHTML("studentPopName",_sl[_ci].name[0]);
    if (cdn(_sl[_ci].bd[0]) != original[2]) {findBd()}
    var edit = [_sl[_ci].name[0].toString(),_sl[_ci].gender,cdn(_sl[_ci].bd[0]),_sl[_ci].email,_sl[_ci].name[1].toString(),_sl[_ci].allergies];
    var labels = ["name","gender","birthday","email","name pronunciation","allergies"];
    for (let i = 0; i < original.length; i++) {
        if (original[i] != edit[i]) {
            activityLog(original[0] + " " + labels[i] + " edited",original[i] + "-->" + edit[i],dateAndTime("log"));
        }
    }
    sortSL(); 
    for (let i = 0; i < _sl.length; i++) {if (_sl[i].name[0] == _sl[_ci].name[0]) {_ci = i; break}}
    refreshStudentPop(); allAlerts(); storeAndBackup();
    if (_currentFunction == loadNeededEmails || _currentFunction == loadNeededBds) {_currentFunction()};
    if (document.getElementById("rapidEditCheck").checked) {
        if (_ci < _sl.length-1) {
            _ci++; refreshStudentPop(); refreshMissionsPop(); populateStudentFields();
        } else if (_ci == _sl.length-1) {
            goHome(); rapidOff();
        }
    } else {
        resetStudentMenu(); editStudentPop();
    }
}

function editStudentPop() {
    if (_array == "loadStudent") {
        pop(["editStudentPop"],["missionsPop"]);
    }
    if (_array == "alertsPop") {
        pop(["editStudentPop"],["customListPop"]);
    }
}

function alertsPop() {
    pop(["mainPop"],["alertsPop"]); _array = ["alertsPop"];
}

function customListPop() {
    if (_array == "alertsPop") {
        pop(["customListPop"],["alertsPop"]);
    }
}

function refreshStudentPop() {
    assignStatsRanks("pts",0);
    document.getElementById("studentPopInsignia").style.backgroundImage = "url(img/insignia-darkgray/"+_sl[_ci].rank[0]+"-rank.jpg)";
    innerHTML("studentPopRankName",_rankNames[_sl[_ci].rank[0]]);
    innerHTML("studentPopName",_sl[_ci].name[0]);
    var ptsNeeded;
    if (_sl[_ci].pts == 220) {
        ptsNeeded = 0
    } else {
        ptsNeeded = _rankPts[_sl[_ci].rank[0]+1] - _sl[_ci].pts;
    }
    innerHTML("studentPopPts",_sl[_ci].pts + " | <span style='color: #999'>" + ptsNeeded +"</span>");
    if (_rankNames[_sl[_ci].rank[0]].length > 20) {
        document.getElementById("studentPopRankName").style.fontSize = "15px";
    } else {
        document.getElementById("studentPopRankName").style.fontSize = "18px";
    }
    if (_sl[_ci].att) {
        color("studentPopName","lawngreen");
    } else {
        color("studentPopName","white");
    }
    if (_rankNames[_sl[_ci].rank[0]].length > 20) {
        document.getElementById("studentPopRankName").style.fontSize = "30px";
    } else {
        document.getElementById("studentPopRankName").style.fontSize = "30px";
    }
    if (_sl[_ci].name[0].length > 15) {
        document.getElementById("studentPopName").style.fontSize = "30px";
    } else {
        document.getElementById("studentPopName").style.fontSize = "30px";
    }
    var properties = ["name","gender","bdMonth","bdDate","email","photo"];
    for (let i = 0; i < properties.length; i++) {
        if (_sl[_ci][properties[i]] == false) {
            color("studentMenu2","red"); break;
        } else {
            color("studentMenu2","white");
        }
    }
}

function refreshMissionsPop() {
    if (_ew > 1) {
        for (let i = (_ti-1); i >= 0; i--) {
            if (i >= _asNames.length) {continue}
            if (_sl[_ci].as[i][0] == _asMaxPts[i]) {
                bgColor("as"+i+"Pop","green");
            } else if (_sl[_ci].as[i][0] > 0 && _sl[_ci].as[i][0] < _asMaxPts[i]) {
                bgColor("as"+i+"Pop","darkorange");
            } else {
                bgColor("as"+i+"Pop","black");
            }
        }
        for (let i = (_ti-1); i >= 0; i--) {
            if (i >= _mvNames.length) {continue}
            if (_sl[_ci].mv[i][0] == _mvMaxPts[i]) {
                bgColor("mv"+i+"Pop","green");
            } else if (_sl[_ci].mv[i][0] > 0 && _sl[_ci].mv[i][0] < _mvMaxPts[i]) {
                bgColor("mv"+i+"Pop","darkorange");
            } else {
                bgColor("mv"+i+"Pop","black");
            }
        }
    }
}

function populateStudentFields(id,func) {
    if (func) {_currentFunction = func}
    document.getElementById("editFirst").value = _sl[_ci].name[0].split(" ")[0];
    document.getElementById("editLast").value = _sl[_ci].name[0].split(" ")[1];
    if (_sl[_ci].bd[0] != 0) {
        value("editBdMonth",cdn(_sl[_ci].bd[0],"M").toString());
        value("editBdDate",cdn(_sl[_ci].bd[0],"D").toString());
    } else {
        value("editBdMonth","");
        value("editBdDate","");
    }
    value("editEmail",_sl[_ci].email);
    value("editGender",_sl[_ci].gender);
    value("editNamePron",_sl[_ci].name[1]);
    value("editAllergies",_sl[_ci].allergies);
    loadStudentPhoto();
    if (_array == "alertsPop") {
        pop(["customListPop"],["editStudentPop"]);
    }
    if (id) {idFocus(id)}
}

function clearStudentFields() {
    var ids = ["newFirst","newLast","newGender","newbdMonth","newbdDate","newEmail","initialNote","newNamePron","newAllergies"];
    for (let i = 0; i < ids.length; i++) {
        value(ids[i],"");
    }
}

function rapidOff() {
    document.getElementById("rapidEntryCheck").checked = false;
    document.getElementById("rapidEditCheck").checked = false;
}

function populatePromos() {
    innerHTML("promoList",""); innerHTML("bdayList","");
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].promoDns[_sl[i].rank[0]] == _todaysDn && _sl[i].att) {
            var p1 = createElement("p");
            p1.style.fontSize = "25px";
            if (_sl[i].bd[3] == _todaysDn) { p1.style.color = "fuchsia" }
            p1.innerHTML = _sl[i].name[0] + " (" + _rankNamesShort[_sl[i].rank[0]] + ") (" + _sl[i].promo + ")";
            append("promoList",p1);
        }
        if (_sl[i].bd[1] && _sl[i].bd[3] == _todaysDn && _sl[i].att) {
            var p2 = createElement("p");
            p2.style.fontSize = "25px";
            if (_sl[i].promo > 0) { p2.style.color = "yellow" }
            p2.innerHTML = _sl[i].name[0] + " (" + cdn(_sl[i].bd[0]) + ")";
            append("bdayList",p2);
        }
    }
}

function promo() {
    _sl[_ci].rank[0]++; _sl[_ci].promo++;
    setRankFactor();
    innerHTML("studentPopRankName",_rankNames[_sl[_ci].rank[0]]);
    innerHTML("dispRankNamePromo",_rankNames[_sl[_ci].rank[0]]);
    storeAndBackup();
    document.getElementById("promoInsignia").style.backgroundImage = "url(img/insignia-darkgray/"+_sl[_ci].rank[0]+"-rank.jpg)";
    activityLog(_sl[_ci].name[0] + " promoted (" + _sl[_ci].promo + ") to " + _rankNamesShort[_sl[_ci].rank[0]],dateAndTime("log"));
    setTimeout(function() {
        pop(["studentPop","missionsPop"],["promoPop"])
    },10);
}

function demo() {
    _sl[_ci].promoDns[_sl[_ci].rank[0]] = 0; _sl[_ci].rank[0]--;
    _sl[_ci].promo--;
    setRankFactor();
    activityLog(_sl[_ci].name[0] + " demoted to " + _rankNamesShort[_sl[_ci].rank[0]],dateAndTime("log"));
    innerHTML("studentPopRankName",_rankNames[_sl[_ci].rank[0]]);
    storeAndBackup();
}

function asPts(_asNum,x) {
    if (document.getElementById("as"+x+"Pts").style.color == "rgb(51, 51, 51)") {return} 
    if (_sl[_ci].as[_asNum][1] == 0) {_sl[_ci].as[_asNum][1] = _todaysDn};
    var rankNum = _sl[_ci].rank[0];
    var rankFactor = _sl[_ci].rank[1];
    var totalPts = _sl[_ci].pts;
    var asPts = _sl[_ci].as[_asNum][0];
    var netPts = x - _sl[_ci].as[_asNum][0];
    var promoStatus = 0;
    if (_sl[_ci].rank[0] != 8 && _sl[_ci].rank[0] != 14 && _sl[_ci].rank[0] != 18) {
        if (asPts == 0 || asPts < x) {
            if ((totalPts - ((rankNum + rankFactor) * 10)) + netPts >= 10 && totalPts < 220) {
                promoStatus = 1;
            }
            _sl[_ci].pts += netPts;
            _sl[_ci].as[_asNum][0] = x;
        }
        if (asPts > x) {
            if ((totalPts + netPts < ((rankNum + rankFactor) * 10))) {
                promoStatus = -1;
            }
            _sl[_ci].pts += netPts;
            _sl[_ci].as[_asNum][0] = x;
        }
        if (asPts == x) {
            _sl[_ci].as[_asNum][1] = 0;
            if ((totalPts - ((rankNum + rankFactor) * 10)) - x < 0) {
                promoStatus = -1;
            }
            _sl[_ci].pts -= x; netPts = -x;
            _sl[_ci].as[_asNum][0] = 0;
        }
    } else if (_sl[_ci].rank[0] == 8 || _sl[_ci].rank[0] == 14 || _sl[_ci].rank[0] == 18) {
        if (asPts == 0 || asPts < x) {
            if ((totalPts - ((rankNum + rankFactor) * 10)) + x >= 20) {
                promoStatus = 1;
            }
            _sl[_ci].pts += netPts;
            _sl[_ci].as[_asNum][0] = x;
        }
        if (asPts > x) {
            if ((totalPts + netPts < ((rankNum + rankFactor) * 10))) {
                promoStatus = -1;
            }
            _sl[_ci].pts += netPts;
            _sl[_ci].as[_asNum][0] = x;
        }
        if (asPts == x) {
            if (_sl[_ci].as[_asNum][1] == _todaysDn) {
                _sl[_ci].as[_asNum][1] = 0;
            }
            if ((totalPts - ((rankNum + rankFactor) * 10)) - x < 0) {
                promoStatus = -1;
            }
            _sl[_ci].pts -= x; netPts = -x;
            _sl[_ci].as[_asNum][0] = 0;
        }
    }
    var plusSign = ""; if (netPts > 0) {plusSign = "+"}
    activityLog(_sl[_ci].name[0] + " " + plusSign + netPts + " points " + _asNames[_asNum] + " sheet ","(" + asPts + "-->" + _sl[_ci].as[_asNum][0] + ")" + " (" + (_sl[_ci].pts - netPts) + "-->" + _sl[_ci].pts + ")",dateAndTime("log"));
    if (promoStatus > 0) {
        promo();
    } else if (promoStatus < 0) {
        demo();
    }
    assignStatsRanks("pts",0); storeAndBackup(); loadStudent(_ci);
    pop(["asPtsPop"],["missionsPop"]);
}

function mvPts(_mvNum,x) {
    if (document.getElementById("mv"+x+"Pts").style.color == "rgb(51, 51, 51)") {return} 
    if (_sl[_ci].mv[_mvNum][1] == 0) {_sl[_ci].mv[_mvNum][1] = _todaysDn};
    var rankNum = _sl[_ci].rank[0];
    var rankFactor = _sl[_ci].rank[1];
    var totalPts = _sl[_ci].pts;
    var mvPts = _sl[_ci].mv[_mvNum][0];
    var netPts = x - _sl[_ci].mv[_mvNum][0];
    var promoStatus = 0;
    if (_sl[_ci].rank[0] != 8 && _sl[_ci].rank[0] != 14 && _sl[_ci].rank[0] != 18) {
        if (mvPts == 0 || mvPts < x) {
            if ((totalPts - ((rankNum + rankFactor) * 10)) + netPts >= 10 && totalPts < 220) {
                promoStatus = 1;
            }
            _sl[_ci].pts += netPts;
            _sl[_ci].mv[_mvNum][0] = x;
        }
        if (mvPts > x) {
            if ((totalPts + netPts < ((rankNum + rankFactor) * 10))) {
                promoStatus = -1;
            }
            _sl[_ci].pts += netPts;
            _sl[_ci].mv[_mvNum][0] = x;
        }
        if (mvPts == x) {
            _sl[_ci].mv[_mvNum][1] = 0;
            if ((totalPts - ((rankNum + rankFactor) * 10)) - x < 0) {
                promoStatus = -1;
            }
            _sl[_ci].pts -= x; netPts = -x;
            _sl[_ci].mv[_mvNum][0] = 0;
        }
    } else if (_sl[_ci].rank[0] == 8 || _sl[_ci].rank[0] == 14 || _sl[_ci].rank[0] == 18) {
        if (mvPts == 0 || mvPts < x) {
            if ((totalPts - ((rankNum + rankFactor) * 10)) + x >= 20) {
                promoStatus = 1;
            }
            _sl[_ci].pts += netPts;
            _sl[_ci].mv[_mvNum][0] = x;
        }
        if (mvPts > x) {
            if ((totalPts + netPts < ((rankNum + rankFactor) * 10))) {
                promoStatus = -1;
            }
            _sl[_ci].pts += netPts;
            _sl[_ci].mv[_mvNum][0] = x;
        }
        if (mvPts == x) {
            if (_sl[_ci].mv[_mvNum][1] == _todaysDn) {
                _sl[_ci].mv[_mvNum][1] = 0;
            }
            if ((totalPts - ((rankNum + rankFactor) * 10)) - x < 0) {
                promoStatus = -1;
            }
            _sl[_ci].pts -= x; netPts = -x;
            _sl[_ci].mv[_mvNum][0] = 0;
        }
    }
    var plusSign = ""; if (netPts > 0) {plusSign = "+"}
    activityLog(_sl[_ci].name[0] + " " + plusSign + netPts + " points " + _mvNames[_mvNum] + " verse ","(" + mvPts + "-->" + _sl[_ci].mv[_mvNum][0] + ")" + " (" + (_sl[_ci].pts - netPts) + "-->" + _sl[_ci].pts + ")",dateAndTime("log"));
    if (promoStatus > 0) {
        promo();
    } else if (promoStatus < 0) {
        demo();
    }
    assignStatsRanks("pts",0);
    storeAndBackup();
    loadStudent(_ci);
    pop(["mvPtsPop"],["missionsPop"]);
}

function searchNames(id,className) {
    var inputVal = document.getElementById(id).value.toLowerCase();
    var names = document.getElementsByClassName(className);
    for (let i = 0; i < names.length; i++) {
        if (names[i].innerHTML.toLowerCase().search(inputVal) >= 0) {
            names[i].style.display = "block";
        } else {
            names[i].style.display = "none";
        }
    }
}

function searchNamesMain() {
    var inputVal = document.getElementById("searchMain").value.toLowerCase();
    var names = document.getElementsByClassName("name");
    var nameSpans = document.getElementsByClassName("nameSpan");
    for (let i = 0; i < nameSpans.length; i++) {
        if (nameSpans[i].innerHTML.toLowerCase().search(inputVal) >= 0 && inputVal != " ") {
            names[i].style.display = "block";
        } else {
            names[i].style.display = "none";
        }
    }
    for (let i = 0; i < nameSpans.length; i++) {
        if (names[i].style.display == "block") {
            display("newStudentButton","none"); break;
        }
        display("newStudentButton","block");
    }
}

function searchLog() {
    var inputVal = document.getElementById("searchLog").value.toLowerCase();
    var logEntries = document.getElementsByClassName("logEntry");
    var logSpans = document.getElementsByClassName("logSpan");
    for (let i = 0; i < logSpans.length; i++) {
        if (logSpans[i].innerHTML.toLowerCase().search(inputVal) >= 0) {
            logEntries[i].style.display = "block";
        } else {
            logEntries[i].style.display = "none";
        }
    }
}

function resetSearchLog() {
    var logEntries = document.getElementsByClassName("logEntry");
    for (let i = 0; i < logEntries.length; i++) {
        logEntries[i].style.display = "block";
    }
}

function searchGameLog() {
    var inputVal = document.getElementById("searchGameLog").value.toLowerCase();
    var logEntries = document.getElementsByClassName("gameLogEntry");
    var logSpans = document.getElementsByClassName("gameLogSpan");
    for (let i = 0; i < logSpans.length; i++) {
        if (logSpans[i].innerHTML.toLowerCase().search(inputVal) >= 0) {
            logEntries[i].style.display = "block";
        } else {
            logEntries[i].style.display = "none";
        }
    }
}

function loadStudent(index) {
    _ci = index; _currentStudent = _sl[_ci].name[0];
    value("searchMain","");
    checkInAtt(); refreshStudentPop(); refreshMissionsPop(); resetMissions(); resetStudentMenu();
    loadLbs();
    document.activeElement.blur();
    if (document.getElementById("editStudentPop").style.display != "block") {
        pop(["mainPop"],["studentPop","missionsPop"]);
    }
}

function loadLbs() {
    if (!pointsExist()) {
        display("lbContainer","none"); display("lbMssg","block");
        innerHTML("lbMssg","Leader boards will appear here once students start earning points."); return
    } else {
        display("lbContainer","block"); display("lbMssg","none");
        sortByPts(true); sortByASpts(true); sortByMVpts(true); sortByAtt(true); sortByTP(true); sortSL();
    }
}

function resetStudentMenu() {
    for (let i = 0; i < 4; i++) {
        if (i == 0) {
            bgColor("studentMenu"+i,"#777");
        } else {
            bgColor("studentMenu"+i,"black");
        }
    }
}

function studentMenuSwitch(x) {
    var allPops = document.getElementsByClassName("pop");
    var pops = ["missionsPop","studentStatsPop","editStudentPop","notesPop","studentPropertiesPop"];
    var funcs = [false,loadStudentStats,populateStudentFields,populateNotes];
    for (let i = 0; i < 4; i++) {
        if (i == x) {
            bgColor("studentMenu"+i,"#777");
        } else {
            bgColor("studentMenu"+i,"black");
        }
    }
    for (let i = 0; i < 5; i++) {
        if (i == x) {
            display(pops[i],"block");
            if (i > 0 && i < 4) { funcs[i]() }
        }
    }
    for (let i = 0; i < allPops.length; i++) {
        if (allPops[i].id != pops[x] && allPops[i].id != "studentPop") {
            allPops[i].style.display = "none";
        }
    }
    scrollToFix();
}

function asLinks() {
    window.open("docs/missions/as"+_asNum+".pdf","_blank");
}

function scanLinks() {
    window.open("docs/as-scans/"+_sl[_ci].name[0].split(" ")[0].toLowerCase()+"-"+_sl[_ci].name[0].split(" ")[1].toLowerCase()+"-"+_asNum+".pdf","_blank");
}

function mvLinks() {
    window.open("docs/memory/mv"+_mvNum+".pdf","_blank");
}

function pop(closeArray,openArray,title) {
    for (let i = 0; i < closeArray.length; i++) {
        if (closeArray != []) {
            display(closeArray[i],"none");
        }
    }
    for (let i = 0; i < openArray.length; i++) {
        if (openArray != []) {
            display(openArray[i],"block");
        }    
    }
    scrollToFix();
}

function logPop() {
    value("searchLog",""); innerHTML("log",_log); resetSearchLog();
    pop(['mainPop'],['logPop']); idFocus("searchLog");
}

function promoListPop() {
    populatePromos();
    pop(['logPop'],['promoListPop']);
}

function gameLogPop() {
    value("searchGameLog",""); innerHTML("gameLog",_gameLog);
    pop(['playGamePop'],['gameLogPop'])
}

function teamsListPop() {
    display("teamsListNav","flex");
    display("teamsListButtons","block");
    pop(['att3Pop'],['teamsListPop'])
}

function pwdPop() {
    if (_isClassDay) {
        pop(['wtlPop'],['pwdPop']);
        idFocus("pwd");
    } else {
        loadBackup();
    }
}

function customSortListPop(id,title) {
    innerHTML("customSortListLabel",title);
    pop([id],["customSortListPop"]);
} 

function sortChoicePop() {
    if (_sl == false) {
        infoAlert("You must add at least one student before sorting",["mainMenuPop"]);return
    } else {
        _currentPop = "sortChoicePop"
        pop(['mainMenuPop'],['sortChoicePop'])
    }
}

function allergiesPop() {
    sortByAllergies();
    pop(['mainPop'],['allergiesPop'])
}

function shufflePhotosPop() {
    shufflePhotos();
    pop(['mainMenuPop'],['shufflePhotosPop']);
}

function populateBackup() {
    for (let i = 0; i < _sl.length; i++) {
        batchDeletePropertyQuick(["earnedASpts","asPercentage","earnedMVpts","mvPercentage","totalWksAtt","tpPts"])
    }
    pop(["mainPop"],["backupPop"]);
}

function goHome() {
    var pops = document.getElementsByClassName("pop");
    for (let i = 0; i < pops.length; i++) {
        pops[i].style.display = "none";
        display("mainPop","block");
    }
    value("searchMain","");
    idFocus("searchMain");
    sortSL(); populateNames(); allAlerts(); scrollToFix();
}

function asPop(asNum,pts) {
    _asNum = asNum;
    innerHTML("asSheetName",_asNames[_asNum].toUpperCase());
    innerHTML("asDateAssigned",cdn(_dns[asNum]));
    if (_sl[_ci].as[_asNum][0] == _asMaxPts[_asNum]) {
        innerHTML("asCompletionStatus","COMPLETED");
        color("asCompletionStatus","lawnGreen");
    } else if (_sl[_ci].as[_asNum][0] == 0) {
        innerHTML("asCompletionStatus","NOT TURNED IN");
        color("asCompletionStatus","red"); 
    } else {
        innerHTML("asCompletionStatus","PARTIAL CREDIT");
        color("asCompletionStatus","orange");
    }
    if (_sl[_ci].as[_asNum][0] > 0) {
        display("scannedImage","table-cell");
    } else {
        display("scannedImage","none");
    }
    if (_sl[_ci].as[_asNum][1] == 0) {
        innerHTML("asDateTurnedIn","-");
    } else {
        innerHTML("asDateTurnedIn",cdn(_sl[_ci].as[_asNum][1]));
    }
    display("missionsPop","none");
    display("asPtsPop","block");
    for (let i =1; i <= 6; i++) {
        if (document.getElementById("as"+i+"Pts").innerHTML == _sl[_ci].as[_asNum][0]) {
            bgColor("as"+i+"Pts","#3478F6");
        } else {
            bgColor("as"+i+"Pts","black");
        }
    }
    for (let i =1; i <= 6; i++) {
        if (i <= pts) {
            display("as"+i+"Pts","block");
        } else {
            display("as"+i+"Pts","none");
        }
    }
    asLateCheck();
    scrollToFix();
}

function asLateCheck() {
    for (let i = 1; i <= _asMaxPts[_asNum]; i++) {
        color("as"+i+"Pts","white");
        if (i == _sl[_ci].as[_asNum][0]) {
            bgColor("as"+i+"Pts","#3478F6")
        } else {
            bgColor("as"+i+"Pts","black");
        }
    }
    var offset = 0;
    if (_dns[_asNum] < _sl[_ci].dateAdded) {
        offset = _sl[_ci].dateAdded - _dns[_asNum];
    }
    if (_sl[_ci].as[_asNum][0] != _asMaxPts[_asNum]) {
        if ((_todaysDn - _dns[_asNum+1]) > (63 + offset)) {
            bgColor("as"+_asMaxPts[_asNum]+"Pts","#222");
            color("as"+_asMaxPts[_asNum]+"Pts","#333");
        } 
    }
}

function mvPop(mvNum,pts) {
    display("missionsPop","none");
    display("mvPtsPop","block");
    _mvNum = mvNum;
    innerHTML("mvVerseName",_mvNames[_mvNum].toUpperCase());
    innerHTML("mvDateAssigned",cdn(_dns[mvNum]));
    if (_sl[_ci].mv[_mvNum][0] == _mvMaxPts[_mvNum]) {
        innerHTML("mvCompletionStatus","COMPLETED");
        color("mvCompletionStatus","lawnGreen");
    } else if (_sl[_ci].mv[_mvNum][0] == 0) {
        innerHTML("mvCompletionStatus","NOT RECITED");
        color("mvCompletionStatus","red");
    } else {
        innerHTML("mvCompletionStatus","PARTIAL CREDIT");
        color("mvCompletionStatus","orange");
    }
    if (_sl[_ci].mv[_mvNum][1] == 0) {
        innerHTML("mvDateRecited","-");
    } else {
        innerHTML("mvDateRecited",cdn(_sl[_ci].mv[_mvNum][1]));
    }
    innerHTML("mvText","\""+_mvText[mvNum]+"\"");
    for (let i =1; i <= 7; i++) {
        if (document.getElementById("mv"+i+"Pts").innerHTML == _sl[_ci].mv[_mvNum][0]) {
            bgColor("mv"+i+"Pts","#3478F6");
        } else {
            bgColor("mv"+i+"Pts","black");
        }
    }
    for (let i =1; i <= 7; i++) {
        if (i <= pts) {
            display("mv"+i+"Pts","block");
        } else {
            display("mv"+i+"Pts","none");
        }
    }
    mvLateCheck();
    scrollToFix();
}

function mvLateCheck() {
    for (let i = 1; i <= _mvMaxPts[_mvNum]; i++) {
        color("mv"+i+"Pts","white");
        if (i == _sl[_ci].mv[_mvNum][0]) {
            bgColor("mv"+i+"Pts","#3478F6")
        } else {
            bgColor("mv"+i+"Pts","black");
        }
    }
    var offset = 0;
    if (_dns[_mvNum] < _sl[_ci].dateAdded) {
        offset = _sl[_ci].dateAdded - _dns[_mvNum];
    }
    if (_sl[_ci].mv[_mvNum][0] != _mvMaxPts[_mvNum]) {
        if ((_todaysDn - _dns[_mvNum+1]) > (63 + offset)) {
            bgColor("mv"+_mvMaxPts[_mvNum]+"Pts","#222");
            color("mv"+_mvMaxPts[_mvNum]+"Pts","#333");
        } 
    }

} // _dns[_mvNum+1] is the due date dn of the verse in question

function populateNames() {
    innerHTML("nameList","");
    for (let i = 0; i < _sl.length; i++) {
        var p1 = createElement("p");
        var span1 = createElement("span");
        span1.classList.add("quickAttendance");
        span1.setAttribute("id","quickAtt"+i);
        span1.innerHTML = "?"
        if (_sl[i].att) {
            span1.style.color = "lawngreen";
            span1.style.backgroundColor = "lawngreen";
        } else {
            span1.style.color = "#222";
        }
        (function(i){
            span1.onclick = function () {
                _ci = i;  
                toggleAtt(i);
                var id = "quickAtt"+i;
                if (_sl[i].att) {
                    document.getElementById(id).style.color = "lawngreen";
                    document.getElementById(id).style.backgroundColor = "lawngreen";
                } else {
                    document.getElementById(id).style.color = "#222";
                    document.getElementById(id).style.backgroundColor = "black";
                }
                setTimeout(() => {
                    populateNames();
                }, 1000);
            }
        })(i);
        var span2 = createElement("span");
        var span3 = createElement("span");
        var span4 = createElement("span");
        if (_sl[i].att) {
            span3.style.color = "lawnGreen";
        } else {
            span3.style.color = "white";
        }
        p1.classList.add("name");
        span2.innerHTML = "&nbsp;&nbsp;"
        span3.classList.add("nameSpan");
        span4.style.color = "#BBB";
        span4.style.fontSize = "30px";
        (function(i){
            span3.onclick = function () {
                loadStudent(i); _array = "loadStudent";
            }
        })(i);
        span3.innerHTML = _sl[i].name[0];
        span4.innerHTML = " " + _sl[i].pts + " " + _rankNamesShort[_sl[i].rank[0]];
        p1.append(span1,span2,span3,span4);
        append("nameList",p1);
    }
    var p2 = createElement("p");
    p2.setAttribute("id","newStudentButton");
    p2.classList.add("addNew");
    p2.onclick = function () {
        pop(['mainPop'],['newStudentPop']); idFocus("newFirst");
    }
    p2.innerHTML = "Add New Student";
    append("nameList",p2);
    value("searchMain","");
    setTimeout(() => {
        document.getElementById("searchMain").focus();
    }, 1000);
    }

function generateRankTable() {
    for (let i = 0; i < 20; i++) {
        var tr = createElement("tr");
        var td1 = createElement("td"); var td2 = createElement("td");
        var td3 = createElement("td"); var td4 = createElement("td");
        var td5 = createElement("td");
        tr.setAttribute("id","rankChartRow"+i);
        td1.setAttribute("id","rankChartInsignia"+i);
        td2.setAttribute("id","rankChartRank"+i);
        td3.setAttribute("id","rankChartAbbreviation"+i);
        td4.setAttribute("id","rankChartPts"+i);
        td5.setAttribute("id","rankChartDate"+i);
        tr.append(td1,td2,td3,td4,td5);
        append("rankChartTable",tr);
    }
}

function generateAttListTable() {
    for (let i = 0; i < 34; i++) {
        var tr = createElement("tr");
        var td1 = createElement("td"); var td2 = createElement("td");
        var td3 = createElement("td"); var td4 = createElement("td");
        tr.setAttribute("id","attRow"+i);
        td1.setAttribute("id","attDate"+i);
        td2.setAttribute("id","attAM"+i);
        td3.setAttribute("id","attPM"+i);
        td4.setAttribute("id","attBoth"+i);
        tr.append(td1,td2,td3,td4);
        append("attListTable",tr);
    }
}

function generateStudentAttTable() {
    for (let i = 0; i < 34; i++) {
        var tr = createElement("tr");
        var td1 = createElement("td"); var td2 = createElement("td");
        var td3 = createElement("td"); var td4 = createElement("td");
        tr.setAttribute("id","studentAttRow"+i);
        td1.setAttribute("id","studentAttDate"+i);
        td2.setAttribute("id","studentAttAM"+i);
        td3.setAttribute("id","studentAttPM"+i);
        tr.append(td1,td2,td3);
        append("studentAttTable",tr);
    }
}

function generateStudentStatsTables() {
    var tables = ["totalProgressTable","asProgressTable","mvProgressTable","rankProgressTable","attProgressTable","totalParticipationTable"];
    var ids = ["totalProgressBar","asProgressBar","mvProgressBar","rankProgressBar","attProgressBar","totalParticipationBar"];
    for (let i = 0; i < tables.length; i++) {
        var tr = createElement("tr");
        for (let j = 1; j < 41; j++) {
            var td = createElement("td");
            td.setAttribute("id",ids[i]+j);
            tr.append(td);
            append(tables[i],tr);
        }
    }
}

function populateNames2() {
    if (document.getElementById("att2Pop").style.display == "block") {
        pop(['att2Pop'],['studentPop']); return;
    }
    display("att2Pop","block"); innerHTML("nameList2","");
    value("searchMain2",""); idFocus("searchMain2");
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].att) { continue };
        var p = createElement("p");
        p.classList.add("name");
        (function(i){
            p.onclick = function () {
                att2(i);
                pop(["att2Pop"],["studentPop"]);
                value("searchMain2","");
            }
        })(i);
        p.innerHTML = _sl[i].name[0];
        append("nameList2",p);
        idFocus("searchMain2");
    }  
}

function populateNames3(x) {
    display("att3Pop","block");
    display("teamsListNav","none");
    display("teamsListButtons","none");
    innerHTML("nameList3","");
    value("searchMain3",""); idFocus("searchMain3");
    for (let i = 0; i < _sl.length; i++) {
        if (!_sl[i].att || _teams[0].team1Reset.includes(_sl[i].name[0]) || _teams[0].team2Reset.includes(_sl[i].name[0])) { continue }
        var p = createElement("p");
        p.classList.add("name");
        (function(i){
            p.onclick = function () {
                addPlayer(x,i); teamsListPop(); value("searchMain3","");
            }
        })(i);
        p.innerHTML = _sl[i].name[0];
        append("nameList3",p);
        idFocus("searchMain3");
    }  
}

function confirmAction(id) {
    display(id,"block");
}

function deleteReminder() {
    activityLog("deleted reminder","\""+_reminders[_reminderIndex]+"\"",dateAndTime("log"));
    _reminders.splice(_reminderIndex,1);
    storeAndBackup(); populateReminders(); allAlerts();
    pop(["editReminderPop"],["remindersPop","remindersList"]);
}

function editReminder() {
    var a = _reminders[_reminderIndex];
    if (document.getElementById("editReminder").value == "") {
        _reminders.splice(_reminderIndex,1);
    } else {
        _reminders[_reminderIndex] = document.getElementById("editReminder").value.trim();
    }
    activityLog("Reminder edited","\""+a+"\" --> \""+_reminders[_reminderIndex]+"\"",dateAndTime("log"));
    storeAndBackup();
    populateReminders();
    pop(["editReminderPop"],["remindersPop"]);
}

function populateReminders() {
    innerHTML("remindersList","");
    for (let i = 0; i < _reminders.length; i++) {
        var p1 = createElement("p");
        p1.classList.add("note");
        (function(i){
            p1.onclick = function () {
                pop(["remindersPop"],["editReminderPop","editReminder"]);
                idFocus("editReminder");
                _reminderIndex = i;
                value("editReminder",_reminders[_reminderIndex]);
            }
        })(i);
        p1.innerHTML = (i + 1) + ". " + _reminders[i];
        append("remindersList",p1);
    }
    var p2 = createElement("p");
    p2.classList.add("addNew");
    p2.onclick = function () {
        pop(["remindersPop"],["addReminderPop","addReminder"]);
        idFocus("addReminder");
    }
    p2.innerHTML = "Add New Reminder";
    append("remindersList",p2);
}

function checkInAtt() {
    if (_disableAtt) {return}
    if (!_sl[_ci].att) {
        _sl[_ci].att = true;
        if (_isClassDay) {
            if (dateAndTime("hour") < 16) {
                _sl[_ci].attArr[_ti][0] = 1;
            } else {
                _sl[_ci].attArr[_ti][1] = 1;
            }
            ampmAttendance()
        }
        color("studentPopName","lawngreen");
        activityLog("added attendee " + _sl[_ci].name[0],dateAndTime("log"));
        attCount(); storeNewData(); 
    }
}

function toggleAtt() {
    if (_disableAtt) {return}
    if (!_sl[_ci].att) {
        _sl[_ci].att = true;
        activityLog("added attendee " + _sl[_ci].name[0],dateAndTime("log"));
    } else {
        _sl[_ci].att = false;
        activityLog("removed attendee " + _sl[_ci].name[0],dateAndTime("log"));
    }
    if (_isClassDay) {
        if (_sl[_ci].att) {
            if (dateAndTime("hour") < 16) {
                _sl[_ci].attArr[_ti][0] = 1;
            } else {
                _sl[_ci].attArr[_ti][1] = 1;
            } 
        } else {
            if (dateAndTime("hour") < 16) {
                _sl[_ci].attArr[_ti][0] = 0;
            } else {
                _sl[_ci].attArr[_ti][1] = 0;
            } 
        }
        ampmAttendance();
    }
    if (document.getElementById("mainPop").style.display == "block") {allAlerts()}
    attCount(); storeNewData();
    if (document.getElementById("mainPop").style.display != "block") {
        refreshStudentPop();
    }
}

function draw(secondCall) {
    var eligibleNames = [];
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].att && !_sl[i].randDraw[1]) {
            eligibleNames.push(_sl[i])
        }
    }
    if (eligibleNames.length == 0) {
        actionAlert('No more eligible names.  Reset drawing?',['drawPop'],resetDrawing);
    } else {
        if (_picked && !secondCall) { 
            actionAlert("You've already picked a name today. Are you sure you want to pick another?",["drawPop"],draw,false,true);
        } else {
            var x = Math.floor(Math.random() * eligibleNames.length);
            var winner = eligibleNames[x];
            winner.randDraw[1] = true;
            if (winner.name[0].split(" ")[0].length > 9 || winner.name[0].split(" ")[1].length > 9) {
                document.getElementById("drawName").style.fontSize = "65px"; 
            } else {
                document.getElementById("drawName").style.fontSize = "75px"; 
            }
            innerHTML("drawName",winner.name[0].split(" ")[0] + "<br>" + winner.name[0].split(" ")[1]);
            activityLog("drawing winner: "+winner.name[0],dateAndTime("log"));
            _picked = true; storeAndBackup(); 
        }
    }
}

function resetDrawing() {
    for (let i = 0; i < _sl.length; i++) {
        _sl[i].randDraw[1] = false;
    }
    innerHTML("drawName","tap here<br>to pick");
    activityLog("reset drawing",dateAndTime("log"));
    storeAndBackup();
}

function clearDrawingWinner() {
    innerHTML("drawName","tap here<br>to pick");
}

function rand() {
    color("randName","white");
    if (document.getElementById("all").checked) {
        _eligibleRandom = [];
        for (let i = 0; i < _sl.length; i++) {
            if (_sl[i].att && !_sl[i].randDraw[0]) {
                _eligibleRandom.push(_sl[i])
            }
        }
    } else if (document.getElementById("boys").checked) {
        _eligibleRandom = [];
        for (let i = 0; i < _sl.length; i++) {
            if (_sl[i].att && _sl[i].gender == "M" && !_sl[i].randDraw[0]) {
                _eligibleRandom.push(_sl[i])
            }
        }
    } else if (document.getElementById("girls").checked) {
        _eligibleRandom = [];
        for (let i = 0; i < _sl.length; i++) {
            if (_sl[i].att && _sl[i].gender == "F" && !_sl[i].randDraw[0]) {
                _eligibleRandom.push(_sl[i])
            }
        }
    }
    if (_eligibleRandom.length == 0) {
        color("randName","red");
        innerHTML("randName","all names picked");
        for (let i = 0; i < _sl.length; i++) {_sl[i].randDraw[0] = false}
        setTimeout(function() {
            color("randName","white");
            innerHTML("randName","tap here<br>to pick");
        },1000);return
    }
    var x = Math.floor(Math.random() * _eligibleRandom.length);
    var picked = _eligibleRandom[x];
    picked.randDraw[0] = true;
    if (picked.name[0].split(" ")[0].length > 9 || picked.name[0].split(" ")[1].length > 9) {
        document.getElementById("randName").style.fontSize = "65px"; 
    } else {
        document.getElementById("randName").style.fontSize = "75px"; 
    }
    innerHTML("randName",picked.name[0].split(" ")[0] + "<br>" + picked.name[0].split(" ")[1]);
    storeNewData();
}

function storeAndBackup() {
    storeNewData();
    backupNewData();
}

function storeNewData() {
    var globalObjects = [_sl,_att,_reminders,_teams];
    var objectLabels = ["sl","att","reminders","teams"];
    var globalOther = [_log,_gameLog];
    var otherLabels = ["log","gameLog"];
    for (let i = 0; i < globalObjects.length; i++) {
        localStorage.setItem(objectLabels[i],JSON.stringify(globalObjects[i]));
    }
    for (let i = 0; i < globalOther.length; i++) {
        localStorage.setItem(otherLabels[i],globalOther[i]);
    }
}

function backupNewData() {
    innerHTML("slBackupArray","var _slBackup = "+localStorage.getItem("sl")+";");
    innerHTML("attBackupArray","var _attBackup = "+localStorage.getItem("att")+";");
    innerHTML("remindersBackupArray","var _remindersBackup = "+localStorage.getItem("reminders")+";");
    innerHTML("setItem1","localStorage.setItem('slBackup',JSON.stringify(_slBackup));");
    innerHTML("setItem2","localStorage.setItem('attBackup',JSON.stringify(_attBackup));");
    innerHTML("setItem3","localStorage.setItem('remindersBackup',JSON.stringify(_remindersBackup));");
}

function selectText(element) {
    var text = document.getElementById(element);
    var range; var selection;    
    if (document.body.createTextRange) {
        range = document.body.createTextRange();
        range.moveToElementText(text);
        range.select();
    } else if (window.getSelection) {
        selection = window.getSelection();        
        range = document.createRange();
        range.selectNodeContents(text);
        selection.removeAllRanges();
        selection.addRange(range);
    }
}

function populateStudentProperties() {
    innerHTML("studentProperties","");
    for (key in _sl[_ci]) {
        var p = createElement("p");
        var span = createElement("span");
        span.classList.add("ptr");
        p.innerHTML = key + ": ";
        if (typeof _sl[_ci][key] === "object") {
            span.innerHTML = JSON.stringify(_sl[_ci][key]);
        } else {
            span.innerHTML = _sl[_ci][key].toString();
        }
        (function(key){
            span.onclick = function () {
                _currentProperty = key;
                value("editProperty","");
                if (typeof _sl[_ci][key] === "object") {
                    value("editProperty",JSON.stringify(_sl[_ci][key]));
                } else {
                    value("editProperty",_sl[_ci][key]);
                }
                pop(['studentPropertiesPop'],['editPropertyPop']);
                focus("editProperty");
            }
        })(key);
        p.append(span);
        append("studentProperties",p);
    }
}

function editProperty() {
    var x = document.getElementById("editProperty").value.trim();
    if (typeof _sl[_ci][_currentProperty] === "object") {
        try {
            _sl[_ci][_currentProperty] = JSON.parse(x);
        } catch(err) {
            infoAlert(err.message,["editPropertyPop"],false,false,25); return;
        }
    } else if (typeof _sl[_ci][_currentProperty] === "boolean") {
        if (x.toLowerCase().trim() == "true" || x.toLowerCase().trim() == "t") {
            _sl[_ci][_currentProperty] = true;
        } else if (x.toLowerCase().trim() == "false" || x.toLowerCase().trim() == "f") {
            _sl[_ci][_currentProperty] = false;
        } else {
            infoAlert("Value must be<br>\"True\", \"T\", \"False\", or \"F\"",["editPropertyPop"],false,false,25); return;
        }
    } else if (typeof _sl[_ci][_currentProperty] === "number") {
        if (isNaN(x)) {
            infoAlert("value must be a number",["editPropertyPop"]); return;
        }
        _sl[_ci][_currentProperty] = parseInt(x);
    } else {
        _sl[_ci][_currentProperty] = x;
    }
    populateStudentProperties(); refreshStudentPop();
    pop(['editPropertyPop'],['studentPropertiesPop']);
    storeAndBackup();
}

function loadStudentStats() {
    var rankPercentage = (((_sl[_ci].rank[0]) / 19) * 100).toFixed(1);
    var rankSquares = Math.round(rankPercentage / 2.50);
    var totalASpts = 0; var earnedASpts = 0;   
    var totalMVpts = 0; var earnedMVpts = 0;
    for (let i = 0; i < _ti; i++) {
        if (i > (_asMaxPts.length-1)) {break}
        totalASpts += _asMaxPts[i];
        totalMVpts += _mvMaxPts[i];
        earnedASpts += _sl[_ci].as[i][0];
        earnedMVpts += _sl[_ci].mv[i][0];
    }
    var totalPts = totalASpts + totalMVpts;
    var totalEarnedPts = earnedASpts + earnedMVpts;
    var asPercentage = totalPts > 0 ? ((earnedASpts / totalASpts) * 100).toFixed(1) : 0;
    var mvPercentage = totalPts > 0 ? ((earnedMVpts / totalMVpts) * 100).toFixed(1) : 0;
    var totalPtsPercentage = totalPts > 0 ? ((totalEarnedPts / totalPts) * 100).toFixed(1) : 0;
    var asSquares = Math.round(asPercentage / 2.50);
    var mvSquares = Math.round(mvPercentage / 2.50);
    var totalPtsSquares = Math.round(totalPtsPercentage / 2.50);
    var weeksAttended = 0;
    for (let i = 0; i < _ew; i++) {
        weeksAttended += _sl[_ci].attArr[i][0];
        weeksAttended += _sl[_ci].attArr[i][1];
        if (_sl[_ci].attArr[i][0] == 1 && _sl[_ci].attArr[i][1] == 1) {
            weeksAttended--;
        }
    }
    var attPercentage = ((weeksAttended / _ew) * 100).toFixed(1);
    var attSquares = Math.round(attPercentage / 2.50);
    var totalEarned = weeksAttended + earnedASpts + earnedMVpts;
    var totalPossible = _ew + totalASpts + totalMVpts;
    var totalPercentage = ((totalEarned / totalPossible) * 100).toFixed(1);
    var totalSquares = Math.round(totalPercentage / 2.50);
    var squaresArray = [totalPtsSquares,asSquares,mvSquares,rankSquares,attSquares,totalSquares];
    var variableArray = [totalPtsPercentage,asPercentage,mvPercentage,rankPercentage,attPercentage,totalPercentage];
    var idArray1 = ["totalProgressTable","asProgressTable","mvProgressTable","rankProgressTable","attProgressTable","totalParticipationTable"];
    var idArray2 = ["totalProgressBar","asProgressBar","mvProgressBar","rankProgressBar","attProgressBar","totalParticipationBar"];
    for (let i = 0; i < squaresArray.length; i++) {
        for (let j =1; j <= 40; j++) {
            if (j <= squaresArray[i]) {
                if (i > 2) {
                    bgColor(idArray2[i]+j,"#3478F6");
                } else {
                    bgColor(idArray2[i]+j,"lawngreen");
                }
            } else {
                bgColor(idArray2[i]+j,"black");
            }
        }
    }
    for (let i = 0; i < variableArray.length; i++) {
        if (variableArray[i] == 100.00) {
            if (i > 2) {
                bgColor(idArray1[i],"#3478F6");
            } else {
                bgColor(idArray1[i],"lawngreen");
            }
        } else {
            bgColor(idArray1[i],"black");
        }
    }
    innerHTML("rankProgressTableP","<span style='font-size:20px'>Promotions <span style='color:#bbb;font-size:16px'>" + (_sl[_ci].rank[0]) + "/19" + " (" + rankPercentage + "%)</span>");

    innerHTML("totalProgressTableP","<span style='font-size:20px'>Total Points <span style='color:#bbb;font-size:16px'>" + totalEarnedPts + "/" + totalPts + " (" + totalPtsPercentage + "%) | Class Rank: " + _sl[_ci].statsRanks[0]) + "/span";

    innerHTML("asProgressTableP","<span style='font-size:20px'>Activities <span style='color:#bbb;font-size:16px'>" + earnedASpts + "/" + totalASpts + " (" + asPercentage + "%) | Class Rank: " + _sl[_ci].statsRanks[1]) + "/span";

    innerHTML("mvProgressTableP","<span style='font-size:20px'>Memory <span style='color:#bbb;font-size:16px'>" + earnedMVpts + "/" + totalMVpts + " (" + mvPercentage + "%) | Class Rank: " + _sl[_ci].statsRanks[2]) + "/span";

    innerHTML("attProgressTableP","<span style='font-size:20px'>Attendance <span style='color:#bbb;font-size:16px'>" + weeksAttended + "/" + _ew + " (" + attPercentage + "%) | Class Rank: " + _sl[_ci].statsRanks[3]) + "/span";

    innerHTML("totalParticipationTableP","<span style='font-size:20px'>Participation <span style='color:#bbb;font-size:16px'>" + totalEarned + "/" + totalPossible + " (" + totalPercentage + "%) | Class Rank: " + _sl[_ci].statsRanks[4]) + "/span";
}

function populateMissions() {
    innerHTML("asPop",""); innerHTML("mvPop","");
    if (_ew > 1) {
        for (let i = (_ti-1); i >= 0; i--) {
            if (i >= _asNames.length) { continue }
            var div1 = createElement("div");
            div1.setAttribute("id","as"+i+"Pop");
            div1.classList.add("asButton");
            (function(i){
                div1.onclick = function () {
                    asPop(i,_asMaxPts[i]);
                }
            })(i);
            div1.innerHTML = _asFulls[i];
            append("asPop",div1);
        }
        for (let i = (_ti-1); i >= 0; i--) {
            if (i >= _mvNames.length) { continue }
            var div2 = createElement("div");
            div2.setAttribute("id","mv"+i+"Pop");
            div2.classList.add("mvButton");
            (function(i){
                div2.onclick = function () {
                    mvPop(i,_mvMaxPts[i]);
                }
            })(i);
            div2.innerHTML = _mvFulls[i] + "<br>" + "\"" + _mvText[i].split(" ").slice(0,3).join(" ") + " . . .\"";
            append("mvPop",div2);
        }
    }
}

function loadStudentPhoto() {
    document.getElementById("dispStudentPhoto").style.backgroundImage = "none";
    if (_sl[_ci].photo) {
        document.getElementById("dispStudentPhoto").style.backgroundImage = "url(img/students-thumbnails/"+_sl[_ci].name[0].split(" ")[0].toLowerCase()+"-"+_sl[_ci].name[0].split(" ")[1].toLowerCase()+".jpeg)";
        innerHTML("dispStudentPhoto","");
    } else {
        innerHTML("dispStudentPhoto","click here to add<br>student photo");
    }
}

function photoLinks() {
    if (!_sl[_ci].photo) {
        loadPhoto();
    } else {
        window.open("img/students-large/"+_sl[_ci].name[0].split(" ")[0].toLowerCase()+"-"+_sl[_ci].name[0].split(" ")[1].toLowerCase()+".jpeg");
    }
}

function loadPhoto() {
    if (!_sl[_ci].photo) {_sl[_ci].photo = true}
    loadStudentPhoto(); refreshStudentPop(); allAlerts(); storeAndBackup();         
}

/* function doesFileExist(url) {
    var xhr = new XMLHttpRequest();
    xhr.open("GET",url,true);
    xhr.onload = function (e) {
      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
            return true;
        } else {
            return false;
        }
      }
    }
    xhr.onerror = function (e) {
      console.error(xhr.statusText);
    }
    xhr.send(null);
} */

function scrollToFix() {
    window.scrollTo(0,0); window.scrollTo(0,1); window.scrollTo(0,0);
}

function loadRankTable() {
    var ids = ["missionsPop","studentStatsPop","editStudentPop","notesPop"];
    for (let i = 0; i < ids.length; i++) {
        if (document.getElementById(ids[i]).style.display == "block") {
            document.getElementById(ids[i]).style.display = "none"
        }
        display("rankChartPop","block")
    }
    for (let i = 0; i < _rankNames.length; i++) {
        let x; x = i;
        document.getElementById("rankChartInsignia"+i).style.backgroundImage = "url(img/insignia-darkgray/"+i+"-rank.jpg)";
        innerHTML("rankChartRank"+i,_rankNames[i]);
        innerHTML("rankChartAbbreviation"+i,_rankNamesShort[i]);
        innerHTML("rankChartPts"+i,_rankPts[i]);
        innerHTML("rankChartDate"+i,cdn(_sl[_ci].promoDns[i]))
        if (i == _sl[_ci].rank[0]) {
            document.getElementById("rankChartRow"+i).style.border = "3px solid lawngreen";
        } else {
            document.getElementById("rankChartRow"+i).style.border = "1px solid white";
        }
    }
    scrollToFix();
}

function openInsignia() {
    document.getElementById("displayInsignia").style.backgroundImage = "url(img/insignia-darkgray/"+_sl[_ci].rank[0]+"-rank.jpg)";
    pop(["studentStatsPop"],["openInsigniaPop"]);
}

function toggleIncomplete() {
    if (_ew > 1) {
        var noneHidden = true;
        for (let i = 0; i < (_ew-2); i++) {
            if (document.getElementById("as"+i+"Pop").style.display == "none" || document.getElementById("mv"+i+"Pop").style.display == "none") {
                noneHidden = false; break;
            }
        }
        if (noneHidden) {
            for (let i = 0; i < (_ew-2); i++) {
                if (_sl[_ci].as[i][0] < _asMaxPts[i]) {
                    display("as"+i+"Pop","block");
                } else {
                    display("as"+i+"Pop","none");
                }
                if (_sl[_ci].mv[i][0] < _mvMaxPts[i]) {
                    display("mv"+i+"Pop","block");
                } else {
                    display("mv"+i+"Pop","none");
                }
            }
        } else {
            for (let i = 0; i < (_ew-2); i++) {
                display("as"+i+"Pop","block");
                display("mv"+i+"Pop","block");
            }
        }
    }
}

function resetMissions() {
    if (_ew > 1) {
        for (let i = 0; i < (_ew-2); i++) {
            display("as"+i+"Pop","block");
            display("mv"+i+"Pop","block");
        }
    }
}

function averageArray(array) {
    function sum(a,b) {return a + b}
    return Math.round(array.reduce(sum)/array.length);
}

function sumArray(array) {
    function sum(a,b) {return a + b}
    return array.reduce(sum);
}

function sumArrays(arrays) {
    var sum = 0;
    for (let i = 0; i < arrays.length; i++) {sum += sumArray(arrays[i])}
    return sum;
}

function compareAtt() {
    for (let j = 0; j < _dns.length; j++) {    
        var invididualWeekArrayAM = [];
        var invididualWeekArrayPM = [];
        for (let i = 0; i < _sl.length; i++) {
            invididualWeekArrayAM.push(_sl[i].attArr[j][0])
            invididualWeekArrayPM.push(_sl[i].attArr[j][1])
        }
        if (sumArray(invididualWeekArrayAM) != _att[j][0]) {
            console.log("Week " + j + " AM attendance " + sumArray(invididualWeekArrayAM) + " vs " + _att[j][0])
        } 
        if (sumArray(invididualWeekArrayPM) != _att[j][1]) {
            console.log("Week " + j + " PM attendance " + sumArray(invididualWeekArrayPM) + " vs " + _att[j][1])
        } 
    }
}

function listAttendees(m,d) {
    var AM = []; var PM = [];
    index = _dns.indexOf(assignDn(m,d));
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].attArr[index][0] == 1) {
            AM.push(_sl[i].name[0]);
        }
        if (_sl[i].attArr[index][1] == 1) {
            PM.push(_sl[i].name[0]);
        }
    }
    console.log(AM); console.log(PM);
}

function loadAttStats() {
    if (_todaysDn <= _dns[0] && dateAndTime("hour") < 18) {
        infoAlert("Attendance stats will not be generated until after 6pm on the first class day",["mainMenuPop"]);return
    }
    var amArray = []; var pmArray = []; var bothArray = [];
    var amBoysArray = []; var pmBoysArray = []; var amGirlsArray = []; var pmGirlsArray = [];
    var amPmBoysArray = []; var amPmGirlsArray = [];
    var ew;
    if (_isClassDay && dateAndTime("hour") < 18) {
        ew = _ew -1;
    } else {
        ew = _ew;
    }
    for (let i = 0; i < ew; i++) {
        amArray.push(_att[i][0]);
        pmArray.push(_att[i][1]);
        bothArray.push(_att[i][0] + _att[i][1]);
    }
    for (let i = 0; i < _sl.length; i++) {
        for (let j = 0; j < ew; j++) {
            if (_sl[i].attArr[j][0] > 0) {
                if (_sl[i].gender == "M") {
                    amBoysArray.push(_sl[i].attArr[j][0]);
                    amPmBoysArray.push(_sl[i].attArr[j][0]);
                } else {
                    amGirlsArray.push(_sl[i].attArr[j][0]);
                    amPmGirlsArray.push(_sl[i].attArr[j][0]);
                }
            }
            if (_sl[i].attArr[j][1] > 0) {
                if (_sl[i].gender == "M") {
                    pmBoysArray.push(_sl[i].attArr[j][1]);
                    amPmBoysArray.push(_sl[i].attArr[j][1]);
                } else {
                    pmGirlsArray.push(_sl[i].attArr[j][1]);
                    amPmGirlsArray.push(_sl[i].attArr[j][1]);
                }
            }
        }
    }
    innerHTML("amAvg",averageArray(amArray));
    innerHTML("pmAvg",averageArray(pmArray));
    innerHTML("bothAvg",averageArray(bothArray));
    innerHTML("amMax",Math.max(...amArray));
    innerHTML("pmMax",Math.max(...pmArray));
    innerHTML("bothMax",Math.max(...bothArray));
    innerHTML("amMin",Math.min(...amArray));
    innerHTML("pmMin",Math.min(...pmArray));
    innerHTML("bothMin",Math.min(...bothArray));
    innerHTML("amBoysAvg",Math.round((sumArray(amBoysArray))/ew));
    innerHTML("pmBoysAvg",Math.round((sumArray(pmBoysArray))/ew));
    innerHTML("bothBoysAvg",Math.round((sumArray(amPmBoysArray))/ew));
    innerHTML("amGirlsAvg",Math.round((sumArray(amGirlsArray))/ew));
    innerHTML("pmGirlsAvg",Math.round((sumArray(pmGirlsArray))/ew));
    innerHTML("bothGirlsAvg",Math.round((sumArray(amPmGirlsArray))/ew));
    for (i = 0; i < amArray.length; i++) {
        innerHTML("attDate"+i,cdn(_dns[i]));
        innerHTML("attAM"+i,_att[i][0]);
        innerHTML("attPM"+i,_att[i][1]);
        innerHTML("attBoth"+i,_att[i][0] + _att[i][1]);
        document.getElementById("attAM"+i).classList.add("ptr");
        document.getElementById("attPM"+i).classList.add("ptr");
        (function(i){
            document.getElementById("attAM"+i).onclick = function () {
                loadArchiveAttendees(i,"AM");
            }
            document.getElementById("attPM"+i).onclick = function () {
                loadArchiveAttendees(i,"PM");
            }
        })(i);
    }
    for (let i = 0; i < 34; i++) {
        if (i < _ew) {
            display("attRow"+i,"table-row");
        } else {
            display("attRow"+i,"none");
        }
    }
    pop(["mainMenuPop"],["attStatsPop"]);
}

function loadStudentAttStats() {
    for (let i = 0; i < _ew; i++) {
        innerHTML("studentAttDate"+i,cdn(_dns[i]));
        if (_sl[_ci].attArr[i][0] == 1) {
            innerHTML("studentAttAM"+i,"X");
        } else {
            innerHTML("studentAttAM"+i,"");
        }
        if (_sl[_ci].attArr[i][1] == 1) {
            innerHTML("studentAttPM"+i,"X");
        } else {
            innerHTML("studentAttPM"+i,"");
        }
        if (_sl[_ci].attArr[i][0] == 0 && _sl[_ci].attArr[i][1] == 0) {
            color("studentAttDate"+i,"red");
        } else {
            color("studentAttDate"+i,"lawngreen");
        }
    }
    for (let i = 0; i < 34; i++) {
        if (i < _ew) {
            display("studentAttRow"+i,"table-row");
        } else {
            display("studentAttRow"+i,"none");
        }
    }
    pop(["studentStatsPop"],["studentAttStatsPop"]);
}

function cdn(dn,type) {
    if (dn == 0) {return "-"}
    var months = [8,9,10,11,12,1,2,3,4,5,6,7];
    var cumulative = [0,31,61,92,122,153,184,212,243,273,304,334];
    var cumulativeLeap = [0,31,61,92,122,153,184,213,244,274,305,335];
    var month; var date;
    if (!_leapYear) {
        for (let i = 0; i < cumulative.length; i++) {
            if (dn >= cumulative[i] && dn <= cumulative[i+1]) {
                month = months[i]; date = dn - cumulative[i]; break;
            }
            if (dn > 334) {
                month = 7; date = dn - 334; break;
            }
        }
    } else {
        for (let i = 0; i < cumulative.length; i++) {
            if (dn >= cumulativeLeap[i] && dn <= cumulativeLeap[i+1]) {
                month = months[i]; date = dn - cumulativeLeap[i]; break;
            }
            if (dn > 335) {
                month = 7; date = dn - 335; break;
            }
        }
    }
    if (type == "M") {return month} else if (type == "D") {return date} else {return month + "/" + date}
}

function assignDn(month,date) {
    if (month == 0 || date == 0) {return 0} var dn;
    var cumulative = [153,184,212,243,273,304,334,0,31,61,92,122];
    var cumulativeLeap = [153,184,213,244,274,305,335,0,31,61,92,122];
    if (month < 3 || month > 7) {
        dn = (cumulative[month-1]) + date;
    }
    if (month > 2 || month < 8) {
        if (_leapYear) {
            dn = (cumulativeLeap[month-1]) + date;
        } else {
            dn = (cumulative[month-1]) + date;
        }
    }
    return dn;
}

function assignClassDns() {
    var cumulative = [153,184,212,243,273,304,334,0,31,61,92,122];
    var cumulativeLeap = [153,184,213,244,274,305,335,0,31,61,92,122];
    var months = [8,8,9,9,9,10,10,10,10,10,11,11,12,12,12,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5]; // must be edited manually
    var dates = [21,28,11,18,25,2,9,16,23,30,6,13,4,11,18,8,15,22,29,5,12,19,26,5,12,19,26,2,16,23,30,7,14,21]; // must be edited manually
    var dns1 = []; var dns2 = [];
    for (let i = 0; i < months.length; i++) {
        if (months[i] >= 8) {
            dns1.push(cumulative[months[i]-1] + dates[i]);
        }
        if (months[i] < 8) {
            if (_leapYear) {
                dns2.push(cumulativeLeap[months[i]-1] + dates[i]);
            } else {
                dns2.push(cumulative[months[i]-1] + dates[i]);
            }
        }
    }
    var dnsCombined = dns1.concat(dns2);
    console.log(dnsCombined);
}

function allEmailsOnFile() {
    if (confirm("Confirm batch action") == true) {
        for (let i = 0; i < _sl.length; i++) {
            _sl[i].email = "on file"
        }
    } 
    storeAndBackup();
}

function batchFilterSL(property,value) {
    var count = 0;
    for (let i = 0; i < _sl.length; i++) {
        if(_sl[i][property] == value) {
            console.log(_sl[i].name[0]); count++;
        } 
    }
    if (count == 0) { 
        console.log("no results");
    } else { 
        console.log(count + " MATCHES / " + (_sl.length - count) + " NON-MATCHES");
    }
}

function batchDisplaySL(property) {
    for (let i = 0; i < _sl.length; i++) {
        console.log(_sl[i].name[0] + ": " + _sl[i][property]);
    }
    var values = [];
    var occurrences = [];
    for (let i = 0; i < _sl.length; i++) {
        if (values.indexOf(_sl[i][property]) < 0) {
            values.push(_sl[i][property]); occurrences[values.indexOf(_sl[i][property])] = 1;
        } else {
            occurrences[values.indexOf(_sl[i][property])]++
        }
    }
    console.log("\n"+"**********OCCURRENCES**********");
    for (let i = 0; i < values.length; i++) {
        console.log(values[i] + "(" + occurrences[i] + ")")
    }
}

function displayStudentProperties(full) {
    var result = false;
    for (let i = 0; i < _sl.length; i++) {
        if(_sl[i]["name"][0] == full) {
            result = true;
            for (let x in _sl[i]) {
                if (typeof _sl[i][x] !== "object") {
                    console.log(x + ": " + _sl[i][x]); 
                }
            }
            for (let x in _sl[i]) {
                if (typeof _sl[i][x] === "object") {
                    console.log(x + ":");
                    console.log(_sl[i][x]);
                }
            }
            break;
        }
    }
    if (!result) { 
        console.log("The student " + full + " was not found.") 
    }
}

function batchEditObjectSpecial1(objectName) {
    if (confirm("Confirm batch action") == true) {
        for (let i = 0; i < _sl.length; i++) {
            var array = [];
            for (var x in _sl[i][objectName]) {
                array.push(_sl[i][objectName][x]);
            } // creates an array of all values from student.as
            if (array[16] == 6) {
                array[16] = 3;
                array.splice(16,0,3) // if student earned full credit for jn-14-15, assign full credit (3) to jn-14 (now index 16) and full credit (3) to jn-15 (now index 17)
            } else {
                array.splice(16,0,0) // if student earned no pts for jn-14-15, assign 0 pts to jn-14 and jn-15
            }
            for (let j = 0; j < 32; j++) {
                _sl[i][objectName][j] = array[j]
            } // overwrite student.as with properties 0-31 with values from the respective indices from array
        }
        storeAndBackup();
    }
}

function batchEditObjectSpecial2(objectName) {
    if (confirm("Confirm batch action") == true) {
        for (let i = 0; i < _sl.length; i++) {
            for (let j = 0; j < 35; j++) {
                _sl[i].att[j] = [_slOLD[i].amATT[j],_slOLD[i].pmATT[j]]
            }
        }
        batchDeleteProperty("asDates");
        batchDeleteProperty("mvDates");
    }   
    storeAndBackup();
}

function batchEditArray() {
    if (confirm("Confirm batch action") == true) {
        for (let i = 0; i < _sl.length; i++) {
            for (let j = 0; j < _asNames.length; j++) {
                _sl[i].asTEMP[j][0] = _sl[i].as[j][0]
                _sl[i].asTEMP[j][1] = _sl[i].as[j][1]
            }
        }
        storeAndBackup();
    }
}

function batchEditArray2() {
    if (confirm("Confirm batch action") == true) {
        for (let i = 0; i < _sl.length; i++) {
            for (let j = 0; j < _mvNames.length; j++) {
                _sl[i].mvTEMP[j][0] = _sl[i].mv[j][0]
                _sl[i].mvTEMP[j][1] = _sl[i].mv[j][1]
            }
        }
        storeAndBackup();
    }
}

function batchDeleteProperty(propertyName) {
    var doesntExist = []; var count = 0;
    for (let i = 0; i < _sl.length; i++) {
        if (typeof _sl[i][propertyName] === "undefined") {
            doesntExist.push(_sl[i])
        }
    }
    if (confirm("Confirm batch action") == true) {
        for (let i = 0; i < _sl.length; i++) {
            if (typeof _sl[i][propertyName] !== "undefined") {
                delete _sl[i][propertyName]; count++
            }
        }
    }
    console.log("The property '" + propertyName + "' has been deleted from " + count + " out of " + _sl.length + " students");
    if (doesntExist.length > 0) {
        console.log(doesntExist.length + " students did not have property and were skipped:")
        for (let i = 0; i < doesntExist.length; i++) {
            console.log(doesntExist[i].name[0])
        }
    }
    storeAndBackup();
}

function batchDeletePropertyQuick(propertyNames) {
    array = propertyNames;
    for (let i = 0; i < _sl.length; i++) {
        for (let j = 0; j < array.length; j++) {
            delete _sl[i][array[j]];
        }
    }
    storeAndBackup();
}

function batchAddProperty(propertyName,value) {
    if (value === undefined) {
        console.log("initial property value required");return
    }
    var alreadyExists = []; var count = 0;
    for (let i = 0; i < _sl.length; i++) {
        if (typeof _sl[i][propertyName] !== "undefined") {
            alreadyExists.push(_sl[i])
        }
    }
    if (confirm("Confirm batch action") == true) {
        for (let i = 0; i < _sl.length; i++) {
            if (typeof _sl[i][propertyName] === "undefined") {
                _sl[i][propertyName] = value; count++
            }
        }
    }
    console.log("The property '" + propertyName + "' has been added to " + count + " out of " + _sl.length + " students");
    if (alreadyExists.length > 0) {
        console.log(alreadyExists.length + " students already had this property and were skipped. To ensure this property's value is the same for all students, use 'batchEditSL' now:")
        for (let i = 0; i < alreadyExists.length; i++) {
            console.log(alreadyExists[i].name[0] + " '" + propertyName + "': " + alreadyExists[i][propertyName])
        }
    }
    storeAndBackup();
}

function batchEditProperties(propertyName,value) {
    var count = 0; var hasProperty = 0;
    if (confirm("Confirm batch action") == true) {
        for (let i = 0; i < _sl.length; i++) {
            if (typeof(_sl[i][propertyName]) !== "undefined") {
                hasProperty++
            }
        }
        if (hasProperty < _sl.length) {
            console.log("'" + propertyName + "' does not exist for one or more students. Use 'batchAddProperty' instead to add/overwrite this property for all students");return
        }
        for (let i = 0; i < _sl.length; i++) {
            _sl[i][propertyName] = value; count++
        }
    }
    console.log("The property '" + propertyName + "' has been changed to the " + typeof(value) + " '" + value + "' for " + count + " out of " + _sl.length + " students");
    storeAndBackup();
}

function editPropertyConsole(full,property,newValue) {
    var result1 = false; var result2 = false;
    for (let i = 0; i < _sl.length; i++) {
        if(_sl[i]["full"] == full) {
            result1 = true; 
            if(typeof _sl[i][property] !== "undefined") {
                result2 = true; _sl[i][property] = newValue;
            } break;
        }
    }
    if (!result1) { 
        console.log("The student " + full + " was not found.") 
    }
    if (result1 && !result2) { 
        console.log("The property '" + property + "' was not found for " + full ) 
    }
    if (result1 && result2) {
        console.log("The property '" + property + "' was changed to the " + typeof(newValue) + " '" + newValue + "' for " + full) 
    }
    storeAndBackup();
}

function allPhotosTrue() {
    batchEditProperties("photo",true)
}

function allBdsFalse() {
    if (confirm("Confirm batch action") == true) {
        for (let i = 0; i < _sl.length; i++) {
            _sl[i].bd[1] = false;
            _sl[i].bd[2] = false;
        }
        storeAndBackup();
    }
}

function manualSetEw(x) {
    _ew = x; _ti = x-1;
    populateMissions();
}

function shufflePhotos() {
    document.getElementById("togglePhotoTitlesCheck").checked = false;
    innerHTML("shuffledPhotos","");
    var indexes = [];
    for (let i = 0; i < _sl.length; i++) {
        if (_skipPhotos.indexOf(i) >= 0 || _sl[i].photo === false) {continue}
        indexes.push(i)
    }
    shuffleArray(indexes);
    for (let i = 0; i < indexes.length; i++) {
        var div = createElement("div");
        div.classList.add("dispStudentPhoto");
        div.classList.add("ptr");
        div.style.backgroundImage = "url(img/students-thumbnails/"+_sl[indexes[i]].name[0].split(" ")[0].toLowerCase()+"-"+_sl[indexes[i]].name[0].split(" ")[1].toLowerCase()+".jpeg)";
        div.setAttribute("id","photo"+i);
        (function(i){
            div.onclick = function () {
                if (document.getElementById("photoTitle"+i).style.color == "rgb(17, 17, 17)") {
                    color("photoTitle"+i,"white")
                } else {
                    color("photoTitle"+i,"#111")
                }
            }
        })(i);
        var p = createElement("p");
        p.classList.add("ptr");
        p.innerHTML = _sl[indexes[i]].name[0];
        p.style.margin = "5px auto 50px auto"; p.style.color = "#111";
        p.setAttribute("id","photoTitle"+i);
        (function(i){
            p.onclick = function () {
                _skipPhotos.push(indexes[i]);
                display("photo"+i,"none");
                display("photoTitle"+i,"none");
            }
        })(i);
        append("shuffledPhotos",div);
        append("shuffledPhotos",p);
    }
}

function resetShufflePhotos() {
    _skipPhotos = []; shufflePhotos();
}

function togglePhotoTitles() {
    var missingPhotos = 0;
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].photo === false) {missingPhotos++}
    }
    for (let i = 0; i < (_sl.length - _skipPhotos.length - missingPhotos); i++) {
        if (document.getElementById("togglePhotoTitlesCheck").checked) {
            {color("photoTitle"+i,"white")}
       } else {
           color("photoTitle"+i,"#111")
       }
    }
}

function pointsExist() {
    for (let i = 0; i < _sl.length; i++) {
        if (_sl[i].pts > 0) {
            return true
        }
    }
    return false
}

function generateCalendarTable() {
    for (let i = 0; i < _dns.length; i++) {
        var tr1 = createElement("tr");
        var td1 = createElement("td");
        var td2 = createElement("td");
        var td3 = createElement("td");
        var td4 = createElement("td");
        var td5 = createElement("td");
        var td6 = createElement("td");
        td1.classList.add("ti_ew_dn")
        td2.classList.add("ti_ew_dn")
        td3.classList.add("ti_ew_dn")
        td1.innerHTML = i;
        td2.innerHTML = i+1;
        td3.innerHTML = _dns[i];
        td4.innerHTML = cdn(_dns[i]);
        if (i == _ti) {
            tr1.style.border = "3px solid lawngreen";
        }
        if (i < _asNames.length) {
            td5.innerHTML = _asNames[i];
        } else {td5.innerHTML = "-"}
        td5.setAttribute("id","td5-"+i);
        td5.style.width = "118.59px";
        (function(i){
            td5.onclick = function () {
                showMaxPts(i,"as");
            }
        })(i);
        if (i < _mvNames.length) {
            td6.innerHTML = _mvNames[i];
        } else {td6.innerHTML = "-"}
        td6.setAttribute("id","td6-"+i);
        td6.style.width = "100.8px";
        (function(i){
            td6.onclick = function () {
                showMaxPts(i,"mv");
            }
        })(i);    
        tr1.append(td1,td2,td3,td4,td5,td6);
        append("calendarTable",tr1);
    }
}

function showMaxPts(x,type,reset) {
    if (reset) {
        for (let i = 0; i < _asMaxPts.length; i++) {
            document.getElementById("td5-"+i).innerHTML = _asNames[i];
            document.getElementById("td6-"+i).innerHTML = _mvNames[i];
        }
    } else {
        if (type == "as" && x < _asMaxPts.length) {
            if (document.getElementById("td5-"+x).innerHTML == _asNames[x]) {
                document.getElementById("td5-"+x).innerHTML = _asMaxPts[x] + " points";
            } else {
                document.getElementById("td5-"+x).innerHTML = _asNames[x];
            }
        } else if (x < _asMaxPts.length) {
            if (document.getElementById("td6-"+x).innerHTML == _mvNames[x]) {
                document.getElementById("td6-"+x).innerHTML = _mvMaxPts[x] + " points";
            } else {
                document.getElementById("td6-"+x).innerHTML = _mvNames[x];
            } 
        }
    }
}

function listAsByDate(month,day) {
    var totalCt = 0; var asNames = []; var asNamesCt = [];
    for (let i = 0; i < _sl.length; i++) {
        for (let j = 0; j < _asMaxPts.length; j++) {
            if (_sl[i].as[j][1] == assignDn(month,day)) {
                if (asNames.includes(_asNames[j]) === false) {
                    asNames.push(_asNames[j]); asNamesCt[asNamesCt.length] = 1;
                } else {
                    asNamesCt[asNames.indexOf(_asNames[j])]++
                }
                console.log(_sl[i].name[0] + ": " + _asNames[j] + " (" + _sl[i].as[j][0] + "/" + _asMaxPts[j] + ")");
                totalCt++;
            }
        }
    }
    console.log("**********"+"\n"+"Total sheets turned in: " + totalCt);
    for (let i = 0; i < asNames.length; i++) {
        console.log(asNames[i] + ": " + asNamesCt[i])
    }
}

function listAllAs() {
    var totalCt = 0; var asNames = []; var asNamesCt = [];
    for (let i = 0; i < _sl.length; i++) {
        for (let j = 0; j < _asMaxPts.length; j++) {
            if (_sl[i].as[j][1] > 0 && _sl[i].as[j][1] <= _dns[_ti]) {
                if (asNames.includes(_asNames[j]) === false) {
                    asNames.push(_asNames[j]); asNamesCt[asNamesCt.length] = 1;
                } else {
                    asNamesCt[asNames.indexOf(_asNames[j])]++
                }
                console.log(_sl[i].name[0] + ": " + _asNames[j] + " (" + _sl[i].as[j][0] + "/" + _asMaxPts[j] + ")");
                totalCt++;
            }
        }
    }
    console.log("**********"+"\n"+"Total sheets turned in: " + totalCt + " (Average: " + Math.round(totalCt/_ew) + "/week)");
    for (let i = 0; i < asNames.length; i++) {
        console.log(asNames[i] + ": " + asNamesCt[i])
    }
}

function listMvByDate(month,day) {
    var totalCt = 0; var mvNames = []; var mvNamesCt = [];
    for (let i = 0; i < _sl.length; i++) {
        for (let j = 0; j < _mvMaxPts.length; j++) {
            if (_sl[i].mv[j][1] == assignDn(month,day)) {
                if (mvNames.includes(_mvNames[j]) === false) {
                    mvNames.push(_mvNames[j]); mvNamesCt[mvNamesCt.length] = 1;
                } else {
                    mvNamesCt[mvNames.indexOf(_mvNames[j])]++
                }
                console.log(_sl[i].name[0] + ": " + _mvNames[j] + " (" + _sl[i].mv[j][0] + "/" + _mvMaxPts[j] + ")");
                totalCt++;
            }
        }
    }
    console.log("**********"+"\n"+"Total verses recited: " + totalCt);
    for (let i = 0; i < mvNames.length; i++) {
        console.log(mvNames[i] + ": " + mvNamesCt[i])
    }
}

function listAllMv() {
    var totalCt = 0; var mvNames = []; var mvNamesCt = [];
    for (let i = 0; i < _sl.length; i++) {
        for (let j = 0; j < _mvMaxPts.length; j++) {
            if (_sl[i].mv[j][1] > 0 && _sl[i].mv[j][1] <= _dns[_ti]) {
                if (mvNames.includes(_mvNames[j]) === false) {
                    mvNames.push(_mvNames[j]); mvNamesCt[mvNamesCt.length] = 1;
                } else {
                    mvNamesCt[mvNames.indexOf(_mvNames[j])]++
                }
                console.log(_sl[i].name[0] + ": " + _mvNames[j] + " (" + _sl[i].mv[j][0] + "/" + _mvMaxPts[j] + ")");
                totalCt++;
            }
        }
    }
    console.log("**********"+"\n"+"Total verses recited: " + totalCt + " (Average: " + Math.round(totalCt/_ew) + "/week)");
    for (let i = 0; i < mvNames.length; i++) {
        console.log(mvNames[i] + ": " + mvNamesCt[i])
    }
}

function listPromosByDate(month,day) {
    var totalCt = 0; var promoNames = []; var promoNamesCt = [];
    for (let i = 0; i < _sl.length; i++) {
        for (let j = 0; j < _rankNames.length; j++) {
            if (_sl[i].promoDns[j] == assignDn(month,day)) {
                if (promoNames.includes(_rankNamesShort[j]) === false) {
                    promoNames.push(_rankNamesShort[j]); promoNamesCt[promoNamesCt.length] = 1;
                } else {
                    promoNamesCt[promoNames.indexOf(_rankNamesShort[j])]++
                }
                console.log(_sl[i].name[0] + ": " + _rankNamesShort[j]);
                totalCt++;
            }
        }
    }
    console.log("**********"+"\n"+"Total promotions: " + totalCt);
    for (let i = 0; i < promoNames.length; i++) {
        console.log(promoNames[i] + ": " + promoNamesCt[i])
    }
}

/*

localStorage.setItem("sl",JSON.stringify(_sl)); // converts the _sl object to a string and stores as "sl" in localStorage
_sl = JSON.parse(localStorage.getItem("sl")) // parses the localStorage string "sl" into an object and assigns its value to _sl

localStorage.setItem("log",_log); // stores the html <p> element _log as "log" in localStorage
_log = localStorage.getItem("log"); // retrieves "log" from localStorage and assigns its value to _log

*/

assignTodaysDn(); whatToLoad();